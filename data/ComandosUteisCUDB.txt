

#local/assinantesvolte

#Extração da base com LdapSearch
ldapsearch -x -P 3 -h PL0 -p 389 -D "cudbUser=hssuser,ou=admin,dc=tim" -w "hssuser123" -a always -b "dc=tim"
#Filtra todos MSISDN
ldapsearch -x -P 3 -h PL0 -p 389 -D "cudbUser=hssuser,ou=admin,dc=tim" -w "hssuser123" -a always -b "dc=tim" | grep MSISDN:
#Conta quantos assinantes existem
ldapsearch -x -P 3 -h PL0 -p 389 -D "cudbUser=hssuser,ou=admin,dc=tim" -w "hssuser123" -a always -b "dc=tim" | grep MSISDN: | wc -l

# ver todos os contadores, incluindo quantidade de assinantes no LTE e IMS
pmreadcounter

#Consulta ao banco de dados por MySql
#Lista todos MSISDN com mscId
mysql -h pl0 -proot -P 15000 -e "select * from cudb_user_data.IDEN_MSISDN where MSISDN like '55%';"
#Lista todos IMSIs com mscId
mysql -h pl0 -proot -P 15000 -e "select * from cudb_user_data.IDEN_IMSI where IMSI like '724022204186370%';"
#Lista todos IMPIs com mscId
mysql -h pl0 -proot -P 15000 -e "select * from cudb_user_data.IDEN_IMPI where IMPI;"

#Lista IMSI com MSISDN
mysql -h pl0 -proot -P 15000 -e "select c.IMSI, d.MSISDN from cudb_user_data.IDEN_IMSI c, cudb_user_data.IDEN_MSISDN d where c.aliasedObjectName=d.aliasedObjectName;"

#Lista IMSI MSISDN e IMPI
mysql -h pl0 -proot -P 15000 -e "select c.IMSI, d.MSISDN, e.IMPI from cudb_user_data.IDEN_IMSI c, cudb_user_data.IDEN_MSISDN d, cudb_user_data.IDEN_IMPI e where c.aliasedObjectName=d.aliasedObjectName and c.aliasedObjectName=e.aliasedObjectName;"

#Lista IMSI MSISDN IMPI e DSG que está o assinante
mysql -h pl0 -proot -P 15000 -e "select c.IMSI, d.MSISDN, e.IMPI, f.DSUnitGroup from cudb_user_data.IDEN_IMSI c, cudb_user_data.IDEN_MSISDN d, cudb_user_data.IDEN_IMPI e, cudb_user_data.CUDBMultiServiceConsumer f where c.aliasedObjectName=d.aliasedObjectName and c.aliasedObjectName=e.aliasedObjectName and c.aliasedObjectName=CONCAT('mscId=',f.mscId,',ou=multiSCs,dc=tim') and d.MSISDN like '%5521974265511%';"


! clean up total via mysql !

mysql -h pl0 -proot -P 15000 -e "select * from cudb_user_data.IDEN_IMSI where IMSI like '724029410964828%';"
mysql -h pl0 -proot -P 15000 -e "select * from cudb_user_data.IDEN_MSISDN where MSISDN like '%5511949046418%';"
mysql -h pl0 -proot -P 15000 -e "select * from cudb_user_data.IDEN_IMPI where IMPI like '724029410964828%';"
mysql -h pl0 -proot -P 15000 -e "select * from cudb_user_data.IDEN_IMPU where IMPU like 'sip:724029410964828%';"
mysql -h pl0 -proot -P 15000 -e "select * from cudb_user_data.IDEN_IMPU where IMPU like '%5511983418510%';"

mysql -h PL0 -proot -P 15000 -e "delete from cudb_user_data.IDEN_IMSI where IMSI like '724028202719708';" 
mysql -h pl0 -proot -P 15000 -e "delete from cudb_user_data.IDEN_MSISDN where MSISDN like '%5587999365468%';"
mysql -h PL0 -proot -P 15000 -e "delete from cudb_user_data.IDEN_IMPI where IMPI like '724028202719708%';" 
mysql -h PL0 -proot -P 15000 -e "delete from cudb_user_data.IDEN_IMPU where IMPU like 'sip:724029410964828%';" 
mysql -h PL0 -proot -P 15000 -e "delete from cudb_user_data.IDEN_IMPU where IMPU like '%5587999365468%';" 

#Status geral
cudbSystemStatus

#Alarmes
fmactivealarms

#DB Consistency
cudbCheckConsistency

#Backup
cudbSystemDataBackupAndRestore -c

# entrar no cudb onde tem a master do dsg a ser recuperado ( sempre no CUDB que possui a M ) 
cudbUnitDataBackupAndRestore --dsg 36 --node 12

# ver status do backup & restore

cudbManageStore -a -o status


#Restore Backup
cudbSystemDataBackupAndRestore -r <system data backup dir> 

#Contadores
pmreadcounters

#Medições
/cluster/home/cudb/oam/performanceMgmt/output/

#BACKUP
cudb
ssh SC_2_1
cd /home/./backupServer.sh

#parar aprovisionamento

no cudb

/opt/com/bin/cliss

ManagedElement=1,CudbSystem=1,CudbNotifications=1

configure
enabled=false
commit

Fallback

/opt/com/bin/cliss

ManagedElement=1,CudbSystem=1,CudbNotifications=1

configure
enabled=true
commit

! ver erros de ldap no cudb !

HURJO5 SC_2_2# cudbFollowLdapfeLogs | grep -v "err=32" | grep -v "no connection"

HURJO5 SC_2_2# cudbFollowLdapfeLogs | grep "err=80"


! desativar a feature do automatic DSG para mudar de uma dsg master ( AMC ) !

show -v ManagedElement=1,CudbSystem=1,CudbAutomaticMasterChange=1
ManagedElement=1,CudbSystem=1,CudbAutomaticMasterChange=1
configure
enabled=false
commit
up
ManagedElement=1,CudbSystem=1,CudbLocalNode=
applyConfig

! ativar a feature do automatic DSG para mudar de uma dsg master ( AMC ) !

show -v ManagedElement=1,CudbSystem=1,CudbAutomaticMasterChange=1
ManagedElement=1,CudbSystem=1,CudbAutomaticMasterChange=1
configure
enabled=true
commit
up
ManagedElement=1,CudbSystem=1,CudbLocalNode=17
applyConfig
show -v ManagedElement=1,CudbSystem=1,CudbAutomaticMasterChange=1



! procedimento mudança de apontamento do CUDB para notificacao a TI !

>ManagedElement=1,CudbSystem=1,CudbNotifications=1
(CudbNotifications=1)>show
CudbNotifications=1
   enabled=false
   CudbNotificationEvent=AutoProvisioningNotification

(CudbNotifications=1)>CudbNotificationEvent=AutoProvisioningNotification

(CudbNotificationEvent=AutoProvisioningNotification)>show
CudbNotificationEvent=AutoProvisioningNotification
   eventId="AutoProvisioningNotification"
   notificationString="volteAutoProvisionEvent"
   CudbNotificationEndPoint=1
   CudbNotificationEndPoint=2
   CudbNotificationObjectClass=1
   CudbNotificationObjectClass=2

(CudbNotificationEvent=AutoProvisioningNotification)>CudbNotificationEndPoint=1
(CudbNotificationEndPoint=1)>show
CudbNotificationEndPoint=1
   name="HGSNE1"
   URI="http://10.192.73.92:8080"
   webService="/soap/services/notification"
   weight=1

(CudbNotificationEndPoint=1)>up

(CudbNotificationEvent=AutoProvisioningNotification)>CudbNotificationEndPoint=2

(CudbNotificationEndPoint=2)>show
CudbNotificationEndPoint=2
   name="HGRJO1"
   URI="http://10.223.32.92:8080"
   webService="/soap/services/notification"
   weight=1000000000

(CudbNotificationEndPoint=2)>configure

(config-CudbNotificationEndPoint=2)>weight=1

(config-CudbNotificationEndPoint=2)>up

(config-CudbNotificationEvent=AutoProvisioningNotification)>CudbNotificationEndPoint=1

(config-CudbNotificationEndPoint=1)>weight=1000000000

(config-CudbNotificationEndPoint=1)>show
CudbNotificationEndPoint=1
   name="HGSNE1"
   URI="http://10.192.73.92:8080"
   webService="/soap/services/notification"
   weight=1000000000
(config-CudbNotificationEndPoint=1)>up
(config-CudbNotificationEvent=AutoProvisioningNotification)>show
CudbNotificationEvent=AutoProvisioningNotification
   eventId="AutoProvisioningNotification"
   notificationString="volteAutoProvisionEvent"
   CudbNotificationEndPoint=1
   CudbNotificationEndPoint=2
   CudbNotificationObjectClass=1
   CudbNotificationObjectClass=2
(config-CudbNotificationEvent=AutoProvisioningNotification)>up
(config-CudbNotifications=1)>show
CudbNotifications=1
   enabled=false
   CudbNotificationEvent=AutoProvisioningNotification
(config-CudbNotifications=1)>enabled=true
(config-CudbNotifications=1)>commit


   CudbNotificationEndPoint=2
      name="HGRJO3"
      URI="http://10.46.139.34:8080"
      webService="/soap/services/notification"
      weight=1000000000
   CudbNotificationEndPoint=1
      name="HGSNE3"
      URI="http://10.46.131.34:8080"
      webService="/soap/services/notification"
      weight=1

! restart processos de notificacao - auto provisioning !
! procedimento adotado em casos de falha de notificação 


entrar no /var/log

enviar o comando abaixo para verificação de erros nas PLs. Ficará sorteado por data e hora

HUSNE3 SC_2_1# cat PL_2_*/messages | grep CudbNotifications | sort -k 2,3 | grep error
May 10 11:55:24 PL_2_3 CudbNotifications[900] :Notifications SOAP: WARNING - Notification FE SOAP other error at http://10.46.139.34:8080/soap/services/notification
May 10 11:55:24 PL_2_3 CudbNotifications[900] :Notifications SOAP: WARNING - Notification FE SOAP other error at http://10.46.139.34:8080/soap/services/notification
May 10 11:55:25 PL_2_3 CudbNotifications[900] :Notifications SOAP: WARNING - Notification FE SOAP other error at http://10.46.139.34:8080/soap/services/notification
May 10 11:55:30 PL_2_3 CudbNotifications[900] :Notifications SOAP: WARNING - Notification FE SOAP other error at http://10.46.139.34:8080/soap/services/notification
May 10 11:55:31 PL_2_3 CudbNotifications[900] :Notifications SOAP: WARNING - Notification FE SOAP other error at http://10.46.139.34:8080/soap/services/notification
May 10 11:55:31 PL_2_3 CudbNotifications[900] :Notifications SOAP: WARNING - Notification FE SOAP other error at http://10.46.139.34:8080/soap/services/notification

entrar em uma das PLs

ssh PL_2_3

o comando abaixo mostrará os processos responsáveis pela notificação. O ideal é resetar os processos onde o root é o owner

HUSNE3 PL_2_3# ps -auxxx | grep notif
root       123  0.0  0.0      0     0 ?        S     2018   0:00 [fsnotify_mark]
root       890  0.0  0.0 107368  4220 ?        S     2018   0:00 su g_soap -c nice -n 15 sudo -g cudbadmin /opt/ericsson/cudb/notifications/CudbNotifications -f /cluster/home/cudb/common/config/cudbSystem.xml  >> /dev/null  2>&1
g_soap     896  0.0  0.0  11524  1320 ?        Ss    2018   0:00 bash -c nice -n 15 sudo -g cudbadmin /opt/ericsson/cudb/notifications/CudbNotifications -f /cluster/home/cudb/common/config/cudbSystem.xml  >> /dev/null  2>&1
root       897  0.0  0.0 107472  4452 ?        SN    2018   0:00 sudo -g cudbadmin /opt/ericsson/cudb/notifications/CudbNotifications -f /cluster/home/cudb/common/config/cudbSystem.xml
g_soap     900  2.4  0.2 9710336 170112 ?      SNl   2018 7566:38 /opt/ericsson/cudb/notifications/CudbNotifications -f /cluster/home/cudb/common/config/cudbSystem.xml
root     30367  0.0  0.0   9000   672 pts/0    S+   12:15   0:00 grep notif


! verificando metodo de consulta a PLDB local ou MASTER ( MP )

! HUSNE3 !

! este CUDB tem a PLDB como local, pois ele é o MASTER do sistema !
! porém em casos de falha no CUDB é preciso mudar o readModeInPL de local para MASTER e assim ele irá consultar a PLDB master do sistema !
ManagedElement=1,CudbSystem=1,CudbLocalNode=11,CudbLdapAccess=1,CudbLdapUsersMgmt=1,CudbLdapUser=hssuser

CudbLdapUser=hssuser
   cudbUserGroup=""
   cudbUserPassword="*********"
   readModeInDS="MP"
   readModeInPL="MP"
   userLdapAuth="SIMPLE"
   userLdapHash="SHA-256"

! cenário acima é o incorreto. Deve ficar a PL em LP !


! extracao de IMSI e MSISDN no voLTE !

HURJO2 SC_2_2# cd /local/                                         
HURJO2 SC_2_2# ./extract                                          


ao final será armazenado no arquivo imsi_msisdn_VoLTE_20180827.txt.gz


! ver status e logs do LDAP

HURJO3 SC_2_2# cudbFollowLdapfeLogs


! recuperando DSG stopped !

HURJO4 SC_2_2# cudbSystemStatus -R

Execution date: Tue Oct  9 11:09:56 -03 2018

Checking Replication Channels in the System:
	Node    | 11  | 12  | 21  | 22  | 41  | 42  
	============================================
	PLDB ___|__S1_|__S1_|__M__|__S1_|__S1_|__S1_
[-E-]	DSG 1 __|__S1_|_____|_[S]_|_____|__M__|_____
[-E-]	DSG 2 __|__S1_|_____|_[S]_|_____|__M__|_____
[-E-]	DSG 3 __|__S2_|_____|_[S]_|_____|__M__|_____
[-E-]	DSG 4 __|__S2_|_____|_[S]_|_____|__M__|_____
[-E-]	DSG 5 __|__S1_|_____|_[S]_|_____|__M__|_____
[-E-]	DSG 6 __|__S2_|_____|_[S]_|_____|__M__|_____
[-E-]	DSG 7 __|__S2_|_____|_[S]_|_____|__M__|_____
[-E-]	DSG 8 __|__S2_|_____|_[S]_|_____|__M__|_____
	DSG 9 __|__S1_|_____|__S1_|_____|__M__|_____
	DSG 10 _|__S1_|_____|__S2_|_____|__M__|_____
[-E-]	DSG 11 _|__S1_|_____|_[S]_|_____|__M__|_____
[-E-]	DSG 12 _|_____|__S2_|_____|_[S]_|_____|__M__
[-E-]	DSG 13 _|_____|__S1_|_____|_[S]_|_____|__M__
[-E-]	DSG 14 _|_____|__S2_|_____|_[S]_|_____|__M__
[-E-]	DSG 15 _|_____|__S1_|_____|_[S]_|_____|__M__
	DSG 16 _|_____|__S1_|_____|__M__|_____|__S1_
	DSG 17 _|_____|__S1_|_____|__M__|_____|__S1_
	DSG 18 _|_____|__S1_|_____|__M__|_____|__S1_
	DSG 19 _|_____|__S1_|_____|__M__|_____|__S1_
	DSG 20 _|_____|__S2_|_____|__S2_|_____|__M__
	DSG 21 _|_____|__S2_|_____|__S2_|_____|__M__
	DSG 22 _|_____|__S2_|_____|__S2_|_____|__M__

	                     [-E-] [-E-]            

Printing Detailed Replication Status for the Slave Replicas:
Node 11:
        Replication in DSG0(Chan=1)   .... Up -- Delay = 0.1 seconds,   no. of pending changes = 1
        Replication in DSG1(Chan=1)   .... Up -- Delay = 0.2 seconds,   no. of pending changes = 697
        Replication in DSG2(Chan=1)   .... Up -- Delay = 0.1 seconds,   no. of pending changes = 224
        Replication in DSG3(Chan=2)   .... Up -- Delay = 0.1 seconds,   no. of pending changes = 240
        Replication in DSG4(Chan=2)   .... Up -- Delay = 0.1 seconds,   no. of pending changes = 281
        Replication in DSG5(Chan=1)   .... Up -- Delay = 0.1 seconds,   no. of pending changes = 261
        Replication in DSG6(Chan=2)   .... Up -- Delay = 0.1 seconds,   no. of pending changes = 254
        Replication in DSG7(Chan=2)   .... Up -- Delay = 0.2 seconds,   no. of pending changes = 549
        Replication in DSG8(Chan=2)   .... Up -- Delay = 0.1 seconds,   no. of pending changes = 287
        Replication in DSG9(Chan=1)   .... Up -- Delay = 0.1 seconds,   no. of pending changes = 313
        Replication in DSG10(Chan=1)  .... Up -- Delay = 0.1 seconds,   no. of pending changes = 276
        Replication in DSG11(Chan=1)  .... Up -- Delay = 0.1 seconds,   no. of pending changes = 261
Node 12:
        Replication in DSG0(Chan=1)   .... Up -- Delay = 0.1 seconds,   no. of pending changes = 2
        Replication in DSG12(Chan=2)  .... Up -- Delay = 0.2 seconds,   no. of pending changes = 509
        Replication in DSG13(Chan=1)  .... Up -- Delay = 0.1 seconds,   no. of pending changes = 311
        Replication in DSG14(Chan=2)  .... Up -- Delay = 0.1 seconds,   no. of pending changes = 305
        Replication in DSG15(Chan=1)  .... Up -- Delay = 0.1 seconds,   no. of pending changes = 242
        Replication in DSG16(Chan=1)  .... Up -- Delay = 0.0 seconds,   no. of pending changes = 0
        Replication in DSG17(Chan=1)  .... Up -- Delay = 0.0 seconds,   no. of pending changes = 0
        Replication in DSG18(Chan=1)  .... Up -- Delay = 0.0 seconds,   no. of pending changes = 0
        Replication in DSG19(Chan=1)  .... Up -- Delay = 0.0 seconds,   no. of pending changes = 0
        Replication in DSG20(Chan=2)  .... Up -- Delay = 0.0 seconds,   no. of pending changes = 0
        Replication in DSG21(Chan=2)  .... Up -- Delay = 0.0 seconds,   no. of pending changes = 0
        Replication in DSG22(Chan=2)  .... Up -- Delay = 0.0 seconds,   no. of pending changes = 0
Node 21:
        Replication in DSG1           .... Stopped - From Tue Oct  9 01:08:33 -03 2018
        Replication in DSG2           .... Stopped - From Tue Oct  9 01:22:32 -03 2018
        Replication in DSG3           .... Stopped - From Tue Oct  9 01:08:33 -03 2018
        Replication in DSG4           .... Stopped - From Tue Oct  9 01:08:33 -03 2018
        Replication in DSG5           .... Stopped - From Tue Oct  9 01:08:33 -03 2018
        Replication in DSG6           .... Stopped - From Tue Oct  9 01:08:33 -03 2018
        Replication in DSG7           .... Stopped - From Tue Oct  9 01:08:33 -03 2018
        Replication in DSG8           .... Stopped - From Tue Oct  9 01:08:33 -03 2018
        Replication in DSG9(Chan=1)   .... Up -- Delay = 0.2 seconds,   no. of pending changes = 589
        Replication in DSG10(Chan=2)  .... Up -- Delay = 0.2 seconds,   no. of pending changes = 533
        Replication in DSG11          .... Stopped - From Tue Oct  9 01:08:33 -03 2018
Node 22:
        Replication in DSG0(Chan=1)   .... Up -- Delay = 0.0 seconds,   no. of pending changes = 0
        Replication in DSG12          .... Stopped - From Tue Oct  9 01:08:33 -03 2018
        Replication in DSG13          .... Stopped - From Tue Oct  9 01:08:33 -03 2018
        Replication in DSG14          .... Stopped - From Tue Oct  9 01:08:33 -03 2018
        Replication in DSG15          .... Stopped - From Tue Oct  9 01:08:33 -03 2018
        Replication in DSG20(Chan=2)  .... Up -- Delay = 0.0 seconds,   no. of pending changes = 0
        Replication in DSG21(Chan=2)  .... Up -- Delay = 0.0 seconds,   no. of pending changes = 0
        Replication in DSG22(Chan=2)  .... Up -- Delay = 0.0 seconds,   no. of pending changes = 0
Node 41:
        Replication in DSG0(Chan=1)   .... Up -- Delay = 0.1 seconds,   no. of pending changes = 1
Node 42:
        Replication in DSG0(Chan=1)   .... Up -- Delay = 0.0 seconds,   no. of pending changes = 0
        Replication in DSG16(Chan=1)  .... Up -- Delay = 0.0 seconds,   no. of pending changes = 0
        Replication in DSG17(Chan=1)  .... Up -- Delay = 0.0 seconds,   no. of pending changes = 0
        Replication in DSG18(Chan=1)  .... Up -- Delay = 0.0 seconds,   no. of pending changes = 0
        Replication in DSG19(Chan=1)  .... Up -- Delay = 0.0 seconds,   no. of pending changes = 0

HURJO4 SC_2_2# cudbUnitDataBackupAndRestore -d 14 -n 22
WARNING: Restoring the DS cluster will replace previous contents. Are you sure you want to continue (y/n)? y
Action will be executed

CREATE PART
--------------------------------


creating backup on node 42

cudbManageStore stores to process:   ds3 (in dsgroup14).

Starting Backup ...
Launching order Backup for ds3 in dsgroup 14.
Waiting for backup order(s) to be completed in CUDB Node 42 for stores :  ds3.


! apagando usuario pelo ldapdelete

! coletar os dados do usuário, que será colocado no comando, nos dados presentes no response de um SEARCH coletado no EDA em cima do IMSI

Last login: Mon Nov 12 15:45:59 2018 from 10.36.155.171
HURJO3 SC_2_2# history | grep ldapdelete
   28  2018-11-09 18:14:19 ldapsearch -c -x -P 3 -h PL0 -p 389 -D 'cudbUser=hssuser,ou=admin,dc=tim' -w 'hssuser123' ldapdelete -c -x -P 3 -h PL0 -p 389 -D 'cudbUser=hssuser,ou=admin,dc=tim' -w 'hssuser123'
   33  2018-11-09 18:16:19 ldapdelete -c -x -P 3 -h PL0 -p 389 -D 'cudbUser=hssuser,ou=admin,dc=tim' -w 'hssuser123' <<EOF
   44  2018-11-09 18:20:37 ldapdelete -c -x -P 3 -h PL0 -p 389 -D 'cudbUser=hssuser,ou=admin,dc=tim' -w 'hssuser123' <<EOF
  999  2018-11-12 16:19:33 history | grep ldapdelete

HURJO3 SC_2_2# ldapdelete -c -x -P 3 -h PL0 -p 389 -D 'cudbUser=hssuser,ou=admin,dc=tim' -w 'hssuser123' <<EOF
> ImsCxDynInfId=ImsCxDynInf,ImsSubsId=ImsSubs,serv=IMS,assocId=5542999864272,ou=associations,dc=tim
> ImsSubsId=ImsSubs,serv=IMS,assocId=5542999864272,ou=associations,dc=tim
> ImsShDynGroupInfId=ImsShDynGroupInf,ImsAliasGroupId=1,serv=IMS,assocId=5542999864272,ou=Associations,dc=tim
> ImsServIndId=TAS-UPDATE-DATA,ImsAliasGroupId=1,serv=IMS,assocId=5542999864272,ou=Associations,dc=tim
> ImsServIndId=MMTEL-Services,ImsAliasGroupId=1,serv=IMS,assocId=5542999864272,ou=Associations,dc=tim
> ImsServIndId=MMTEL-Extension,ImsAliasGroupId=1,serv=IMS,assocId=5542999864272,ou=Associations,dc=tim
> ImsServIndId=IP-SM-GW,ImsAliasGroupId=1,serv=IMS,assocId=5542999864272,ou=Associations,dc=tim
> ImsServIndId=IMS-ODB-Information,ImsAliasGroupId=1,serv=IMS,assocId=5542999864272,ou=Associations,dc=tim
> ImsServIndId=IMS-CAMEL-Services,ImsAliasGroupId=1,serv=IMS,assocId=5542999864272,ou=Associations,dc=tim
> ImsAliasGroupId=1,serv=IMS,assocId=5542999864272,ou=Associations,dc=tim
> serv=IMS,assocId=5542999864272,ou=associations,dc=tim
> assocId=5542999864272,ou=associations,dc=tim
> IMPI=724044208794807@ims.mnc004.mcc724.3gppnetwork.org,dc=impi,ou=identities,dc=tim
> EOF
HURJO3 SC_2_2# 


dn: IMPU=tel:\2B5591982929410,dc=impu,ou=identities,dc=tim
aliasedObjectName: assocId=5591982929410,ou=associations,dc=tim
IMPU: tel:+5591982929410
objectClass: alias
objectClass: IMPU


ldapdelete -c -x -P 3 -h PL0 -p 389 -D 'cudbUser=hssuser,ou=admin,dc=tim' -w 'hssuser123' <<EOF
serv=Identities,mscId=5401ff7b3856419886f0fa9f11953779,ou=multiSCs,dc=tim
assocId=5521974265511,ou=associations,dc=tim
IMPI=724022204186370@ims.mnc002.mcc724.3gppnetwork.org,dc=impi,ou=identities,dc=tim
EOF


mysql -h pl0 -proot -P 15000 -e "select * from cudb_user_data.IDEN_MSISDN where MSISDN like '5511949046418%';"

Comandos aplicados durante a JM para liberação de provisionamento:
HUSNE3 SC_2_1# cudbDsgProvisioningManage -e 23 
cudbDsgProvisioningManage: Success
DSG 23 is enabled for provisioning.
HUSNE3 SC_2_1# cudbDsgProvisioningManage -e 24
cudbDsgProvisioningManage: Success
DSG 24 is enabled for provisioning.
HUSNE3 SC_2_1# cudbDsgProvisioningManage -e 25
cudbDsgProvisioningManage: Success
DSG 25 is enabled for provisioning.
HUSNE3 SC_2_1# cudbDsgProvisioningManage -e 26
cudbDsgProvisioningManage: Success
DSG 26 is enabled for provisioning.
HUSNE3 SC_2_1# cudbDsgProvisioningManage -e 27
cudbDsgProvisioningManage: Success
DSG 27 is enabled for provisioning.
HUSNE3 SC_2_1# cudbDsgProvisioningManage -e 28
cudbDsgProvisioningManage: Success
DSG 28 is enabled for provisioning.
HUSNE3 SC_2_1# cudbDsgProvisioningManage -e 29
cudbDsgProvisioningManage: Success
DSG 29 is enabled for provisioning.
HUSNE3 SC_2_1# cudbDsgProvisioningManage -e 30
cudbDsgProvisioningManage: Success
DSG 30 is enabled for provisioning.
HUSNE3 SC_2_1# cudbDsgProvisioningManage -e 31
cudbDsgProvisioningManage: Success
DSG 31 is enabled for provisioning.
HUSNE3 SC_2_1# cudbDsgProvisioningManage -e 32
cudbDsgProvisioningManage: Success
DSG 32 is enabled for provisioning.
HUSNE3 SC_2_1# cudbDsgProvisioningManage -e 33
cudbDsgProvisioningManage: Success
DSG 33 is enabled for provisioning.
HUSNE3 SC_2_1# cudbApplyConfig

CUDB Health Check:
fmactivealarms
cudbSystemStatus
cudbCheckConsistency
cudbMpstat
cudbTpsStat
cudbCheckReplication
cudbReallocate -u
pmreadcounter
tipc-config -n
cmw-status -v node
df -h
HUSNE3 SC_2_1# cmw-node-unlock PL_2_21
HUSNE3 SC_2_1# cmw-status -v node

for i in `seq 3 32`;do ssh PL_2_$i "echo;hostname; cat /var/log/ldapfe | grep 'no connection' | grep 'Dec 1 17:2' | wc -l";done

for i in `seq 3 32`;do ssh PL_2_$i "echo;hostname; cat /var/log/ldapfe | grep err=80 | grep 'Dec 1 18:5' | wc -l";done



Exemplo de LdapSearch:
ldapsearch -h PL0 -p 389 -D "cn=manager, dc=tim" -w normal -a always -b "IMSI=724031201701903,dc=imsi,ou=Identities,dc=tim"

ldapsearch -x -P 3 -h PL0 -p 389 -D "cudbUser=hssuser,ou=admin,dc=tim" -w "hssuser123" -a always -b "assocId=5511949046418,ou=associations,dc=tim"
ldapsearch -x -P 3 -h PL0 -p 389 -D "cudbUser=hssuser,ou=admin,dc=tim" -w "hssuser123" -a always -b "MSISDN=5511949046418,dc=msisdn,ou=Identities,dc=tim"


Contadores no CUDB:
/home/cudb/oam/performanceMgmt/output/

Contadores no OSS:
/var/opt/ericsson/sgw/outputfiles/xml/cudb/


Fallback (caso necessário):
cudbDsgProvisioningManage -d 23 
cudbDsgProvisioningManage -d 24
cudbDsgProvisioningManage -d 25
cudbDsgProvisioningManage -d 26
cudbDsgProvisioningManage -d 27
cudbDsgProvisioningManage -d 28
cudbDsgProvisioningManage -d 29
cudbDsgProvisioningManage -d 30
cudbDsgProvisioningManage -d 31
cudbDsgProvisioningManage -d 32
cudbDsgProvisioningManage -d 33
cudbApplyConfig


Realocate de assinantes

cudbReallocate -d 18 --list DryRunNotific1.txt

onde no arquivo deve conter a informação do IMSI conforme abaixo
IMSI:=724310933227549


! decodificacao do transparent data para TI ( OSB-4 ) !

O arquivo está gerado no CUDB SNE, que é o association.ldif.gz

Na SC-2, /local/assinantesVolte ficam os arquivos do CUDB

é preciso decodifica-lo no decoder64

no diretorio /local temos o script MMTELServicesTranslate2.sh que realiza, porém sugere-se abrir para verficar se não há um filtro pronto

abaixo o script presente no diretório /local onde temos um filtro para RBT

HUSNE3 SC_2_2# cat MMTELServicesTranslatePRBT.sh
data=`date +%Y%m%d`
zcat /local/assinantesVoLTE/association* | awk '/ImsServIndId=MMTEL-Services,ImsAliasGroupId=1,serv=IMS/{print;flag=1;next}/dn:/{flag=0}flag' > /local/MMTELServices2.log
gawk -F[.:] -v file=/local/teste '/assocId/{pat=substr($2,65,13)}{if (pat){cmd="base64 <<< \"<msisdn>"pat"</msisdn>\""; cmd | getline msisdn; print msisdn > file; close(cmd); pat=""}}/ServIndTD::/{print substr($0,15) > file;flag=1;text=1;next}/dn:/{flag=0}{if (flag) print > file}' /local/MMTELServices2.log
base64 --decode -i /local/teste > /local/MMTELServices_$data.log
cat /local/MMTELServices_$data.log | awk '/msisdn/{pat=substr($line,59,13)}/customized-alerting-tone authorized="true"/{pat1="PRBT-1"}{if (pat && pat1){print pat; pat=pat1=""}}' > PRBT-1_$data.log


esse script irá entrar no diretorio /local/assinantesVolTE onde temos a extração da base dos dois CUDBs SNE ( onde toda a base está sendo populada ) e realizará 
a decodificação somente no campo de MMTEL services


colocar para rodar em background com o comando at

at now + 1 minutes -f MMTELServicesTranslatePRBT.sh

em um minuto o script comecará a rodar em bkg

para ver o status verificar pelo comando top ou atq



 1015  2018-07-31 17:31:45 cd /local/
 1016  2018-07-31 17:32:28 at 17:33
 1017  2018-07-31 17:32:36 date
 1018  2018-07-31 17:32:37 atq
 1019  2018-07-31 17:32:53 date
 1020  2018-07-31 17:32:57 atq
 1021  2018-07-31 17:32:59 date
 1022  2018-07-31 17:33:02 atq
 1023  2018-07-31 17:33:11 ls -lrth
 1024  2018-07-31 17:33:31 ps auxxx | grep ODB
 1025  2018-07-31 17:36:26 history


! filtro para coletar msisdn com OSB3 setado no CUDB !

base64 --decode -i arquivo_codificado_do_spg.log > arquivo_decodificado.log

cat ODBInfo_20181213.log | awk '/msisdn/{msisdn=$line}/<xcap:Type4>true/{OSB4=1}{if (msisdn && OSB4){print msisdn; msisdn=OSB4=""}}' | grep -oP '(?<=<msisdn>).*(?=</msisdn>)' > OSB4-1_20190201.log 

ou 

cat ODBInfo_20190201.log | grep -B 9 -m 1 "<xcap:Type4>true</xcap:Type4>" | grep -oP '(?<=<msisdn>).*(?=</msisdn>)'

esse ultimo gera maior esforço


cat MMTELServices_20190209.log | awk '/msisdn/{pat=substr($line,59,13)}/<urn:rule id="CFU"><urn:actions><xcap:forward-to><xcap:target>tel:0</{pat1="CFU_FT=0"}{if (pat && pat1){print pat; pat=pat1=""}}' > CFU_FT-0.log


! filtro para coletar IMSI EPS !

zcat assinantesVoLTE/multiSCs_CUDB[1-3]*_20190524* | awk '/EpsDynInfId=EpsDynInf,EpsStaInfId=EpsStaInf/{eps=1;id="";imsi=""}/serv=Identities,mscId=/{id=1}/IMSI:/{imsi=$2}{if (eps && id && imsi){print imsi; eps="";}}' | sort -T /local/ | uniq > imsisEPS24052019

! para rodar no servidor BKPHSS/Extract !

zcat multiSCsCUDB*_20190525.ldif.gz | awk '/EpsDynInfId=EpsDynInf,EpsStaInfId=EpsStaInf/{eps=1;id="";imsi=""}/serv=Identities,mscId=/{id=1}/IMSI:/{imsi=$2}{if (eps && id && imsi){print imsi; eps="";}}' | sort -T /data/BKPHSS/Extract/ | uniq > imsisEPS25052019

! comparar IMSI sem LTE e com VOLTE !

grep -Ff imsiVoLTE imsisEPS > imsiVoLTEeLTE
grep -Fvf imsiVoLTEeLTE imsiVoLTE > imsiVoLTEeNaoLTE

scp imsiVoLTEeNaoLTE bkphss@10.192.12.171:/data/BKPHSS/DelTool/imsiVoLTEeNaoLTE20190129

scp imsi_msisdn_VoLTE_20190205.txt.gz aplspr@10.192.38.106:/home/aplspr/SPG/imsi_msisdn_VoLTE_20190205.txt.gz


scp pdbAutoExport_YLSNE1A_20190205000201.tar.gz aplspr@10.192.38.106:/home/aplspr/BDPR/pdbAutoExport_YLSNE1A_20190205000201.tar.gz

scp pdbAutoExport_CURITIBA-A_20190205000001.tar.gz aplspr@10.192.38.106:/home/aplspr/EPAP/CTA/pdbAutoExport_CURITIBA-A_20190205000001.tar.gz

scp pdbAutoExport_mps-5199-a_20190205000501.tar.gz aplspr@10.192.38.106:/home/aplspr/EPAP/RJO/pdbAutoExport_mps-5199-a_20190205000501.tar.gz

scp pdbAutoExport_mps-5094-a_20190205000001.tar.gz aplspr@10.192.38.106:/home/aplspr/EPAP/RCE/pdbAutoExport_mps-5094-a_20190205000001.tar.gz

scp pdbAutoExport_mps-5213-a_20190205000001.tar.gz aplspr@10.192.38.106:/home/aplspr/EPAP/SNE/pdbAutoExport_mps-5213-a_20190205000001.tar.gz


scp pdbAutoExport_CURITIBA-A_20190205143001.tar.gz aplspr@10.192.38.106:/home/aplspr/BATIMENTO_FULL/AUX_AUTORIZACAO_EPAP/pdbAutoExport_CURITIBA-A_20190205143001.tar.gz

 zcat MMTELServices_20190217.log.gz | grep -m 2 -A 7 -B 43 '<urn:rule id="CFNRc">' 
                                                                                   
awk -v lines=6 '/CFNRc/ {for(i=lines;i;--i)getline; print $0 }' Filtered_MSISDN_CFNRc.log

awk -v lines=6 '/<urn:rule id="CFNRc">/ {for(i=lines;i;--i)getline; print $0 }' Filtered_MSISDN_CFNRc.log                                                                                    

awk '/<urn:rule id="CFNRc">/ {f=NR} f && NR==f+6'/ Filtered_MSISDN_CFNRc.log

cat MMTELServices_20190209.log | awk '/msisdn/{pat=substr($line,59,13)}/ '/<urn:rule id="CFNRc">/ {f=NR} f && NR==f+6'/{pat1="CFU_FT=0"}{if (pat && pat1){print pat; pat=pat1=""}}' > CFU_FT-0.log


! grep com zcat para comparar registros !

grep -xFf <(zcat /local/imsi_msisdn_VoLTE_20190225.txt.gz  | awk '{print $2}') /local/assinantesVoLTE/msisdn_schar9 > /local/assinantesVoLTE/msisdn_schar9_volte 



! comando para coletar numeros com desvio incorreto no vms. Esse comando mostrará os msisdn com desvios 55CN550XXX !

 cat MMTELServices_20190225.log | awk '/msisdn/{msisdn=substr($1,59,13);cfu=""}/55[1-9][1-9]550/{cfu=1}{if (msisdn && cfu){print msisdn; msisdn=cfu=""}}' > voiceMailComCN.log

! comando para coletar numeros com desvio incorreto no vms. Esse comando mostrará os msisdn com desvios 155X !

cat MMTELServices_20190225.log | awk '/msisdn/{msisdn=substr($1,59,13);cfu=""}/<xcap:target>tel:155[0-9]/{cfu=1}{if (msisdn && cfu){print msisdn; msisdn=cfu=""}}' > voiceMailCom155x.log


cat MMTELServices_20190225.log | awk '/msisdn/{msisdn=substr($1,59,13);dcf=cfu=""}/<urn:rule id=\"\CFVM/{dcf=1}/<xcap:target>tel:550551/{cfu=1}{if (msisdn && dcf && cfu){print msisdn; msisdn=dcf=cfu=""}}' > voLTE_DCF_1551.log



! transferencia dados Walace

HOSTNAME : AP01LP
IP : 10.192.38.106
USER : aplspr
PASS : Tim@1234

sftp aplspr@10.192.38.106

ip : 10.192.38.214
user : input_prov
psw : tim@1234

sftp input_prov@10.192.38.214

cd /provision/dump_ti/BATIMENTO_FULL/


[bkphss@mgwsne001 ~]$ sftp migracaoocs@10.192.37.208
Connecting to 10.192.37.208...
Password: migra_123

! lista dos inputs !

cd /inputs/BATIMENTO

/var/TKLC/db/filemgmt 



show ManagedElement=1,SystemFunctions=1,SysM=1,NtpServer=<tab>

show ManagedElement=1,DmxcFunction=1,TimeStatus=1

ManagedElement=1,DmxcFunction=1,TimeStatus=1,ntpq   !teste do ntp server!                                                                                   

! exemplo de cat com awk utilizando substring e if !

cat pdbAutoExport_mps-5199-a_20160125000101 | awk  -F\, '{ if((substr($1,1,2)==55) && substr($2,1,3)==724) print $1";"$2";"$3";"$4 }'

zcat BaseOPSC_2019112600.txt.gz | awk -F \; '{ if ($4==1) print}'   => ao encontrar valor 1 em $4 printa a linha toda

! if com awk procurando um pattern diferente de, utilizando !~ !

cat RN2_Surf_ExisteEPAP.log | awk -F' ' '{ if( $3 !~ /D306/) print}' | grep D

arquivo de input

5511920000000 724170000058708 D306
5511920000918 724170000360906 D306
5511920002000 724170000571656 D306
5511920002067 724170000002993 D306



! filtro para coleta de msisdn e imsi em cima de printout do HSS, somente para perfil EPS !

! Unknown !
cat HSS_NotHLR_Print.log | awk '/<ns:imsi>/{cmd="echo \""$line"\" | grep -oP '\''(?<=<ns:imsi>).*(?=</ns)'\''"; cmd | getline imsi; pat=imsi; pat1=pat2=""; close(cmd)}/<ns:msisdn>/{cmd="echo \""$line"\" | grep -oP '\''(?<=<ns:msisdn>).*(?=</ns)'\''"; cmd | getline msisdn; pat1=msisdn; close(cmd)}/<ns:epsLocationState>UNKNOWN<\/ns:epsLocationState>/{pat2=1}{if (pat && pat2){print pat,pat1; pat=pat1=pat2=""}}'  > BatimentoUnknown.log

! purged !
cat HSS_NotHLR_Print.log | awk '/<ns:imsi>/{cmd="echo \""$line"\" | grep -oP '\''(?<=<ns:imsi>).*(?=</ns)'\''"; cmd | getline imsi; pat=imsi; pat1=pat2=""; close(cmd)}/<ns:msisdn>/{cmd="echo \""$line"\" | grep -oP '\''(?<=<ns:msisdn>).*(?=</ns)'\''"; cmd | getline msisdn; pat1=msisdn; close(cmd)}/<ns:epsLocationState>PURGED<\/ns:epsLocationState>/{pat2=1}{if (pat && pat2){print pat,pat1; pat=pat1=pat2=""}}'  > BatimentoPurged.log

! located !
cat HSS_NotHLR_Print.log | awk '/<ns:imsi>/{cmd="echo \""$line"\" | grep -oP '\''(?<=<ns:imsi>).*(?=</ns)'\''"; cmd | getline imsi; pat=imsi; pat1=pat2=""; close(cmd)}/<ns:msisdn>/{cmd="echo \""$line"\" | grep -oP '\''(?<=<ns:msisdn>).*(?=</ns)'\''"; cmd | getline msisdn; pat1=msisdn; close(cmd)}/<ns:epsLocationState>LOCATED<\/ns:epsLocationState>/{pat2=1}{if (pat && pat2){print pat,pat1; pat=pat1=pat2=""}}'  > BatimentoLocated.log

for n in $(cat IMSI_72403.log | awk '{print $1}'); do cat ent_sub.log | grep $n ; done > IMSI_72403_check.log

for n in $(cat IMSI_72402.log | awk '{print $1}'); do cat ent_sub_72402.log | grep $n ; done > IMSI_72402_check.log

for n in $(cat IMSI_72404.log | awk '{print $1}'); do cat ent_sub_72404.log | grep $n ; done > IMSI_72404_check.log



for n in $(cat BatimentoPurged.log | awk '{print $1}'); do zcat ent_sub_72403.log.gz | grep --text $n ;done > IMSI_72403_Purged.log
for n in $(cat BatimentoPurged.log | awk '{print $1}'); do zcat ent_sub_72402.log.tar.gz | grep --text $n ;done > IMSI_72402_Purged.log
for n in $(cat BatimentoPurged.log | awk '{print $1}'); do zcat ent_sub_72404.log.tar.gz | grep --text $n ;done > IMSI_72404_Purged.log



! coleta imsi e msisdn do perfil HSS-IMS !
cat HLR_NaoExisteSPG_Check.log | awk '/<ns:associationId>/{cmd="echo \""$line"\" | grep -oP '\''(?<=<ns:associationId>).*(?=</ns)'\''"; cmd | getline msisdn; pat=msisdn; pat1=""; close(cmd)}/<ns:defaultPrivateUserId>/{cmd="echo \""$line"\" | grep -oP '\''(?<=<ns:defaultPrivateUserId>).*(?=@ims.)'\''"; cmd | getline imsi; pat1=imsi; close(cmd)}{if (pat && pat1){print pat1,pat; pat=pat1=""}}'  > HLR_NaoExisteSPG_FoundCheck.log

cat SPG_NotHLR_Print.log | awk '/<ns:associationId>/{cmd="echo \""$line"\" | grep -oP '\''(?<=<ns:associationId>).*(?=</ns)'\''"; cmd | getline msisdn; pat=msisdn; pat1=""; close(cmd)}/<ns:defaultPrivateUserId>/{cmd="echo \""$line"\" | grep -oP '\''(?<=<ns:defaultPrivateUserId>).*(?=@ims.)'\''"; cmd | getline imsi; pat1=imsi; close(cmd)}{if (pat && pat1){print pat1,pat; pat=pat1=""}}'  > SPG_NaoExisteHLR_FoundCheck.log

! sort by first column without sort second column !
! este arquivo continha IMSI e MSISDN desordenados e foram ordenados por IMSI !

cat HLR_NaoExisteSPG_FoundCheck.log | sort -n -s -k1,1 > HLR_NaoExisteSPG_FoundCheck.log

! sort by second column without sort the first
cat HLR_NaoExisteSPG_FoundCheck.log | sort -n -s -k2,1 > HLR_NaoExisteSPG_FoundCheck2.log


! batimento OPSC x HSS IMSI divergente !
! compare epap !
for x in $(cat ExisteOPSC_HSSNOK_72403.log) ; do zcat /data/BKPHSS/batimento/02042019/ent_sub_72403_clean.log.tar.gz | grep --text -m1 $x ; done > compareOPSC_imsi72403Epap.log
for y in $(cat ExisteOPSC_HSSNOK_72402.log) ; do zcat /data/BKPHSS/batimento/02042019/ent_sub_72402_clean.log.tar.gz | grep --text -m1 $y ; done > compareOPSC_imsi72402Epap.log
for z in $(cat ExisteOPSC_HSSNOK_72404.log) ; do zcat /data/BKPHSS/batimento/02042019/ent_sub_72404_clean.log.tar.gz | grep --text -m1 $z ; done > compareOPSC_imsi72404Epap.log

! compare volte !
for n in $(cat ExisteOPSC_HSSNOK_72403.log) ; do zcat imsi_msisdn_VoLTE_20190411.txt.gz | grep --text -m1 $n ; done > compareOPSC_imsiVolte_72403.log
for p in $(cat ExisteOPSC_HSSNOK_72402.log) ; do zcat imsi_msisdn_VoLTE_20190411.txt.gz | grep --text -m1 $p ; done > compareOPSC_imsiVolte_72402.log
for q in $(cat ExisteOPSC_HSSNOK_72404.log) ; do zcat imsi_msisdn_VoLTE_20190411.txt.gz | grep --text -m1 $q ; done > compareOPSC_imsiVolte_72404.log

! clean up backup epap !


72402 - epap rjo e rce
72403 - epap spo
72404 - epap cta



cd /var/TKLC/epap/free/pdbi_export/

NPCTA01	root@10.208.1.53
NPRCE02	root@10.212.11.66
NPSNE02	root@10.192.1.80
NPRJO02	root@10.223.48.18


! acesso banco full Paulo !

ssh input_prov@10.192.38.214

cd /works/dumps_bkp/AUTORIZACAO/HLR/

cd /works/dumps_bkp/TARIFACAO/BSCS/
                             /OPSC/

! normalizando os dados no formato MSISDN e IMSI, porém sem sort !

CTA, RCE e SNE
zcat pdbAutoExport* | grep --text ' dn 55' | grep -v D3[0-9][0-9] | awk -F" " '{print $4 " " $2}' | tr -d \, > EPAP.log

zcat pdbAutoExport_CURITIBA-A_*.tar.gz | grep --text 'ent_sub(imsi ' | grep ', dn '| grep 'D[0-9][0-9])' | awk -F" " '{print $4,$2,$6}' | tr -d \, > NPCTA.log
zcat pdbAutoExport_mps-5016-a_*.tar.gz | grep --text 'ent_sub(imsi ' | grep ', dn '| grep 'D[0-9][0-9])' | awk -F" " '{print $4 " " $2}' | tr -d \, > NPRJO.log
zcat pdbAutoExport_mps-5094-a_*.tar.gz | grep --text 'ent_sub(imsi ' | grep ', dn '| grep 'D[0-9][0-9])' | awk -F" " '{print $4 " " $2}' | tr -d \, > NPRCE.log
zcat pdbAutoExport_mps-5213-a_*.tar.gz | grep --text 'ent_sub(imsi ' | grep ', dn '| grep 'D[0-9][0-9])' | awk -F" " '{print $4 " " $2}' | tr -d \, > NPSPO.log

! filtro com imsi, msisdn e hlr
zcat pdbAutoExport_CURITIBA-A_*.tar.gz | grep --text 'ent_sub(imsi ' | grep ', dn '| grep 'D[0-9][0-9])' | awk -F" " '{print $4,$2,$6}' | tr -d \, | tr -d \) | sort -k1 -T /data/BKPHSS > NPCTA.log
zcat pdbAutoExport_mps-5016-a_*.tar.gz | grep --text 'ent_sub(imsi ' | grep ', dn '| grep 'D[0-9][0-9])' | awk -F" " '{print $4,$2,$6}' | tr -d \, | tr -d \) | sort -k1 -T /data/BKPHSS > NPRJO.log
zcat pdbAutoExport_mps-5094-a_*.tar.gz | grep --text 'ent_sub(imsi ' | grep ', dn '| grep 'D[0-9][0-9])' | awk -F" " '{print $4,$2,$6}' | tr -d \, | tr -d \) | sort -k1 -T /data/BKPHSS > NPRCE.log
zcat pdbAutoExport_mps-5213-a_*.tar.gz | grep --text 'ent_sub(imsi ' | grep ', dn '| grep 'D[0-9][0-9])' | awk -F" " '{print $4,$2,$6}' | tr -d \, | tr -d \) | sort -k1 -T /dump > NPSPO.log

! filtro para arquivos merged do epap !

zcat pdbAutoExport_CURITIBA-A*.csv.gz | awk -F";" '{print $2","$1","$3}' | sort -T /data/BKPHSS/ -k1 | sed '/IMSI/d' | grep -v D3[0-9][0-9] | grep ^55 > npcta01.log
zcat pdbAutoExport_mps-5016*.csv.gz | awk -F";" '{print $2","$1","$3}' | sort -T /data/BKPHSS/ProvTool/ -k1 | sed '/IMSI/d' | grep -v D3[0-9][0-9] | grep ^55 > nprjo01.log
zcat pdbAutoExport_mps-5094*.csv.gz | awk -F";" '{print $2","$1","$3}' | sort -T /data/BKPHSS/DelTool/ -k1 | sed '/IMSI/d' | grep -v D3[0-9][0-9] | grep ^55 > npblm01.log
zcat pdbAutoExport_mps-5213*.csv.gz | awk -F";" '{print $2","$1","$3}' | sort -T /data/BKPHSS/Extract -k1 | sed '/IMSI/d' | grep -v D3[0-9][0-9] | grep ^55 > npsne01.log

! coletando dados do hlr com hlr, imsi, msisdn, cat, stype, schar, csp, prbt, red !

zcat H*.csv.gz | awk -F";" '{print $1 " " $2 " " $3 " " $24 " " $93 " " $124 " " $144 " " $146 " " $94}' | sed '/imsi/d' > hlr.log

zcat H*.csv.gz | awk -F";" '{print $1,$2,$3,$24,$93,$124,$144,$146,$94}' | sed '/imsi/d' > hlr.log

zcat H*.csv.gz | awk -F";" '{print $1,$2,$3,$24,$93,$124,$144,$146,$94}' | sed '/imsi/d' > hlr.log ; split -l 16668560 hlr.log hlr ; rm hlr.log

depois retirar os cabecalhos com sed '/imsi/d' hlr.log > hlr1.log

input

EPAP

output

5521982786773 724022002875566
5521982786930 724022002875720
5521982787533 724022002876311

Explicacao :  awk deixa o output somente com o imsi e o msisdn porém com virgula, o tr -d \, retira a virgula pois o -d é delete e o \x é o item a ser retirado

! filtrando somente os numeros de moveis !
cat ent_sub_72403_clean.log | grep --text '551[1-9]9' > ent_sub_72403_clean2.log

! zipando !
tar -czvf ent_sub_72403_clean.log.tar.gz ent_sub_72403_clean.log

! extract !
tar -xzvf archive.tar.gz

! for para coletar de 0 a 9 quantos 8955031x existem !
for i in $(seq 0 9); do cat state1_OPSC.log | grep -c '8955031'$i; done

! removendo espaco em branco !

cat 8x | tr -d "[:space]" > 8x.log 

cat arquivo.in | sed 's/ *$//g' > arquivo.out


zcat 7x*.gz | awk -F";" '/5571991215000/{print $1 " " $2 " " $3}'

zcat HSPO02*.csv.gz | awk -F";" '/$n/{print $1 " " $2 " " $3}' > 1xResult.log


zcat HSNE01_HPSDFOAFILE-0000002599.csv.gz | grep 7240 | awk -F";" '{print $1 " " $2 " " $3}'

! dividindo o arquivo em 500Mb !
split -b 500000000 OPSC1.log

! dividindo em linhas, o que ficará quase com 500M para arquivo contendo MSISDN e IMSI e com nome OPSCaa, OPSCab ... !

split -l 16668560 hlr.log hlr

! procurando numeros na base com CFU !
head -50000 MMTELServices_20190622.log | awk '/msisdn/{cmd="echo \""$line"\" | grep -oP '\''(?<=msisdn>).*?(?=</msisdn>)'\'' | awk '\''{ORS=\"\"}{print $1}'\''"; cmd | getline msisdn; close(cmd)}/CFU/{cmd="echo \""$line"\" | grep -oP '\''(?=CFU).*?(?=>)'\'' | awk '\''{ORS=\"\"}{print $1}'\''"; cmd | getline CFU_A; close(cmd); print msisdn,CFU_A}' 



! mostra qual processo está usando arquivos já deletados !
! este tipo de processo acaba ficando com alta ocupaçao no drive !

pushd /proc ; for i in [1-9]* ; do ls -l $i/fd | grep "(deleted)" && (echo -n "used by: " ; ps -p $i | grep -v PID ; echo ) ; done ; popd 


-wx------ 1 root root 64 Jun  3 11:33 9 -> /var/log/ldapfe.1 (deleted)
used by:  3686 ?        00:24:33 rsyslogd                             


HUSNE3 PL_2_26# kill -9 3686 

! procurar um padrao no começo do arquivo !

zcat imsi_msisdn_VoLTE_20190617.txt.gz | grep --text ^72454


HUSNE3 PL_2_26# pushd /proc ; for i in [1-9]* ; do ls -l $i/fd | grep "(deleted)" && (echo -n "used by: " ; ps -p $i | grep -v PID ; echo ) ; done ; popd 
/proc ~
lrwx------ 1 root root 64 Jun  3 11:33 6 -> /run/nscd/dbzIKZCl (deleted)
lr-x------ 1 root root 64 Jun  3 11:33 7 -> /run/nscd/dbzIKZCl (deleted)
used by: 15953 ?        01:36:46 nscd

lr-x------ 1 root root 64 Jun  3 11:49 3 -> /var/log/ldapfe.1 (deleted)
used by: 17096 ?        00:00:00 tail

lrwx------ 1 root root 64 Jun  3 11:33 11 -> /local/cudb/mysql/mysqldAccess/tmp/ibKeq4p2 (deleted)
lrwx------ 1 root root 64 Jun  3 11:33 4 -> /local/cudb/mysql/mysqldAccess/tmp/ibG13i3T (deleted)
lrwx------ 1 root root 64 Jun  3 11:33 5 -> /local/cudb/mysql/mysqldAccess/tmp/ibbpbYCG (deleted)
lrwx------ 1 root root 64 Jun  3 11:33 6 -> /local/cudb/mysql/mysqldAccess/tmp/ibr6FDct (deleted)
lrwx------ 1 root root 64 Jun  3 11:33 7 -> /local/cudb/mysql/mysqldAccess/tmp/ibP884Nf (deleted)
used by: 26263 ?        00:35:20 mysqld

lrwx------ 1 root root 64 Jun  3 11:33 12 -> /local/cudb/mysql/mysqldMaster/tmp/ibOc3Ltu (deleted)
lrwx------ 1 root root 64 Jun  3 11:33 5 -> /local/cudb/mysql/mysqldMaster/tmp/ibYEyd9j (deleted)
lrwx------ 1 root root 64 Jun  3 11:33 6 -> /local/cudb/mysql/mysqldMaster/tmp/ibEZsmIm (deleted)
lrwx------ 1 root root 64 Jun  3 11:33 7 -> /local/cudb/mysql/mysqldMaster/tmp/ibZqwvhp (deleted)
lrwx------ 1 root root 64 Jun  3 11:33 8 -> /local/cudb/mysql/mysqldMaster/tmp/ibuvvnSr (deleted)
used by: 26435 ?        01:45:03 mysqld

lrwx------ 1 root root 64 Jun  3 11:33 11 -> /local/cudb/mysql/mysqldSlave/tmp/ibe3gC3L (deleted)
lrwx------ 1 root root 64 Jun  3 11:33 4 -> /local/cudb/mysql/mysqldSlave/tmp/ibFKqfAz (deleted)
lrwx------ 1 root root 64 Jun  3 11:33 5 -> /local/cudb/mysql/mysqldSlave/tmp/ibNNWybS (deleted)
lrwx------ 1 root root 64 Jun  3 11:33 6 -> /local/cudb/mysql/mysqldSlave/tmp/ibqGBSMa (deleted)
lrwx------ 1 root root 64 Jun  3 11:33 7 -> /local/cudb/mysql/mysqldSlave/tmp/ibBJRYpt (deleted)
used by: 26610 ?        00:25:26 mysqld

ls: cannot access 2932/fd: No such file or directory
ls: cannot access 29984/fd: No such file or directory
ls: cannot access 29987/fd: No such file or directory
l-wx------ 1 root root 64 Jun  3 11:51 9 -> /var/log/ldapfe.1 (deleted)
used by:  4737 ?        00:00:02 rsyslogd

~

scp ExisteHLR_NaoPCRFOracle.csv.gz bkphss@10.192.12.171:/data/BKPHSS/Extract/Batimento/20190701/
scp ExisteHLR_NaoPCRFCisco.csv.gz  bkphss@10.192.12.171:/data/BKPHSS/Extract/Batimento/20190701/
scp ExisteHSS_NaoExisteHLR.csv.gz  bkphss@10.192.12.171:/data/BKPHSS/Extract/Batimento/20190701/
scp ExistePCRFOracle_NaoHLR.csv.gz bkphss@10.192.12.171:/data/BKPHSS/Extract/Batimento/20190701/
scp ExistePCRFCisco_NaoHLR.csv.gz  bkphss@10.192.12.171:/data/BKPHSS/Extract/Batimento/20190701/
scp ExisteSPG_NaoExisteHLR.csv.gz  bkphss@10.192.12.171:/data/BKPHSS/Extract/Batimento/20190701/
scp ExisteHLR_NaoExisteSPG.csv.gz  bkphss@10.192.12.171:/data/BKPHSS/Extract/Batimento/20190701/
scp ExisteSPG_NaoExisteHSS.csv.gz  bkphss@10.192.12.171:/data/BKPHSS/Extract/Batimento/20190701/






-- existehlr_naoexistespg

CREATE TABLE public.existehlr_naoexistespg
(
    msisdn bigint
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;

-- existehlr_naopcrfcisco

CREATE TABLE public.existehlr_naopcrfcisco
(
    msisdn bigint
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;

-- existehlr_naopcrforacle

CREATE TABLE public.existehlr_naopcrforacle
(
    msisdn bigint
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;

-- existehss_naoexistehlr

CREATE TABLE public.existehss_naoexistehlr
(
    msisdn bigint
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;

-- existepcrfcisco_naohlr

CREATE TABLE public.existepcrfcisco_naohlr
(
    msisdn bigint
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;

-- existepcrforacle_naohlr

CREATE TABLE public.existepcrforacle_naohlr
(
    msisdn bigint
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;

-- existespg_naoexistehlr

CREATE TABLE public.existespg_naoexistehlr
(
    msisdn bigint
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;

-- existespg_naoexistehss    

CREATE TABLE public.existespg_naoexistehss
(
    msisdn bigint
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;


COPY public.epap (msisdn,imsi) from 'c:/_dados/26052019/EPAPae' with delimiter ' ';

copy public.existehlr_naoexistespg  (msisdn) from 'c:/_dados/01072019/ExisteHLR_NaoExisteSPG.csv';
copy public.existehlr_naopcrfcisco  (msisdn) from 'c:/_dados/01072019/ExisteHLR_NaoPCRFCisco.csv';
copy public.existehlr_naopcrforacle (msisdn) from 'c:/_dados/01072019/ExisteHLR_NaoPCRFOracle.csv';
copy public.existehss_naoexistehlr  (msisdn) from 'c:/_dados/01072019/ExisteHSS_NaoExisteHLR.csv';
copy public.existepcrfcisco_naohlr  (msisdn) from 'c:/_dados/01072019/ExistePCRFCisco_NaoHLR.csv';
copy public.existepcrforacle_naohlr (msisdn) from 'c:/_dados/01072019/ExistePCRFOracle_NaoHLR.csv';
copy public.existespg_naoexistehlr  (msisdn) from 'c:/_dados/01072019/ExisteSPG_NaoExisteHLR.csv';
copy public.existespg_naoexistehss  (msisdn) from 'c:/_dados/01072019/ExisteSPG_NaoExisteHSS.csv';   

! solucao para falha do erro 80. kill do processo ersip !

  905  2019-07-18 00:26:38 drbd-overview
  906  2019-07-18 00:26:46 ps 32694
  907  2019-07-18 00:27:02 kill -6 32694
  908  2019-07-18 00:27:17 ps aux|grep ersip
  909  2019-07-18 00:27:34 ssh SC_2_2 "ps aux|grep ersip"
  910  2019-07-18 00:27:46 ssh SC_2_2 "ps aux|grep ersip|grep -v grep"
  

! apagando arquivo de log secure do EDA !  

systemctl restart rsyslog.service
service rsyslog status
service rsyslog stop
service rsyslog start 

"sequencia"
systemctl status rsyslog.service


1 - service rsyslog stop

2 - vc deleta com rm secure

3 - cria um arquivo simples (touch secure)

4 - service rsyslog start

5 - systemctl restart rsyslog.service 

verificar se estará populando novamente 
  
  
! tratando base FNR !  
  
! não há filtro de mvno !
  
cat SPS-NP_2_20190802* | tr -d \F | sed '/IMSI/d' | awk -F"," '{print $2","$1}' | sort -k1 > imsi0208.log

cat SPS-NP_1_20190802* | awk -F"," '{print $2","$7}' | tr -d \F | sed '/USR/d' | sort -k1 > msisdn0208.log

join -t ',' imsi.log msisdn.log > fnr.log


ms-windows-store


! utilizando comandos no EDA para CUDB !

[root@hgrjo3-03 ~]# telnet 10.46.139.18 8023

User: cai3guser
PWD: Cai3guser1!

hgrjo3-03>CUDBSUP:MSISDN=5511985236777;

[root@hgrjo3-03 ~]# cd /var/dve/cli
[root@hgrjo3-03 cli]# ls
69_CUDBSUP_20190815_150812.xml.zip  70_CUDBSUP_20190815_151126.xml.zip  71_CUDBSUP_20190815_151154.xml.zip


    CUDBSUE:IMPI="724031413129347@ims.mnc003.mcc724.3gppnetwork.org";
    CUDBSUE:IMPU="sip:+5512981930390@ims.tim.br";
    CUDBSUE:IMPU="tel:+5512981930390";
    CUDBSUE:IMPU="sip:724031413129347@ims.mnc003.mcc724.3gppnetwork.org";
    
    
cudbsue:IMPU=sip:"\+5512981930390@ims.tim.br";

 cudbsup:msisdn="5534992433586";
 cudbsue:impi="sip:724023204089404@ims.mnc002.mcc724.3gppnetwork.org";
 cudbsue:impu="sip:+5534992433586@ims.tim.br";
 cudbsue:impu="tel:+5534992433586";
 cudbsue:impu="sip:724023204089404@ims.mnc002.mcc724.3gppnetwork.org";
 
 
! coleta de dados nos logs do SPG para numeros que estão com falha de aprovisionamento ( falha COPYNODE )

zcat ServiceLog_2019081214*.tar.gz | grep --text 'COPY' | grep ModUserData | grep -o -P '.{0,0}MSISDN.{0,42}' | tr -d \/'"' | sort | uniq 

! coleta de dados nos logs do EDA para verificar erro 13003 !
! coletará todos em um intervalo de tempo, deixando na ordem e contando a quantidade de vezes que o numero apareceu !

zcat proclog_2019-09-11_11* | grep --text 13003 | grep -oP '(?<=imsi=).*(?=","CREATE","FAILED")' | sort | uniq -c

! coletou ANF e contou as quantidades, utilizando o uniq -c ! 
cat SIEBEL_PRE_TROUBLE_TICKET_20191211122009.txt | awk -F \| '{print(substr($8,1,2))}' | sort | uniq -c

input
[input_prov@ap06lp CRC]$ more SIEBEL_PRE_TROUBLE_TICKET_20191211122009.txt 
10/12/2019 00:00:27|Reclama?|Servi?Voz|N?Origina/Recebe|Cancelado Siebel|Enviado|20191307154871|31975203504
10/12/2019 00:10:04|Reclama?|Promo?|Erro no Funcionamento|Aberto|Unassigned|20191307170276|96981127940
10/12/2019 07:24:41|Reclama?|Servi?Internet|Erro no Funcionamento|Cancelado Siebel|Enviado|20191307502847|44999944557
10/12/2019 07:31:11|Reclama?|Promo?|Erro no Funcionamento|Aberto|Unassigned|20191307521788|11952157130

output
[input_prov@ap06lp CRC]$ cat SIEBEL_PRE_TROUBLE_TICKET_20191211122009.txt | awk -F \| '{print(substr($8,1,2))}' | sort | uniq -c
    612 11
     37 12
     22 13
     15 14
...

IPs - 10.46.131.34 e 10.46.139.34 --> o&m dos EDAs
 
! Conectar no EDA
telnet 10.46.131.34 8010
caiuser / Caiuser1!  


agsui:imsi=724031210317484,eki=568FADE97895AADD42D030D48D1A63A5,kind=64,fsetind=2,a4ind=0;

hgsui:msisdn=5511981131469,imsi=724031210317484,profile=1;
hgsdc:msisdn=5511981131469,sud=csp-17;
hgsnc:msisdn=5511981131469,nam=0;
hgsdc:msisdn=5511981131469,sud=ofa-11;
hgsdc:msisdn=5511981131469,sud=stype-44;
hgsdc:msisdn=5511981131469,sud=pdpcp-4;
hgsdc:msisdn=5511981131469,sud=clip-1;
hgsdc:msisdn=5511981131469,sud=clir-1;

hgsdp:msisdn=5511981131469,all;


MOD SCCPADDRPL:SCCPRPLNM="HLR_HRRJO1_HRSNE1_HRCTA1",ROUTT=SLS,PRIORITY0=1,PRIORITY1=1,PRIORITY2=0;


!Mudando arquivos tipo tsv ( tab separeted value ) por csv!

sed -i 's/\t/,/g' input_file

ou por ;

sed -i 's/\t/;/g' input_file

! trocando : por ; via sed !
sed -i 's/\:/;/g' OCSxSPG_0602f.log

Esse comando modificará o arquivo original sem criar novo

! coletar numeros do CUDB migrados para HLR-FE, mostrando MSISDN e IMSI !

logado no HUSNE3
SC-2 / /local/assinantesVoLTE/
HUSNE3 SC_2_2# zcat multiSCs_CUDB*.ldif.gz | grep 'dn: serv=CSPS,mscId=' -A 50  | grep MSISDN -A1
MSISDN: 5511981131469                                                                            
IMSI: 724031210317484                                                                            
--                                                                                               
MSISDN: 5541995041565                                                                            
IMSI: 724044204546771                                                                            
--                                                                                               

! parser do primo para osb e csp das extracoes do spg

gzip -dc association_CUDB*.ldif.gz | sh parse_spg_file.sh_v2 > SPG.log &
 ! newest !
 
chmod x+ no arquivo new_parse_spg_file_v2.pl
 
nohup gzip -dc association_CUDB1.ldif.gz | perl new_parse_spg_file_v2.pl > association_CUDB1.spg.log &
nohup gzip -dc association_CUDB2.ldif.gz | perl new_parse_spg_file_v2.pl > association_CUDB2.spg.log &
nohup gzip -dc association_CUDB3.ldif.gz | perl new_parse_spg_file_v2.pl > association_CUDB3.spg.log &
! coletando valores null no awk !
cat SPG_CSP.log | awk -F \; '{if(!$3)print}'

ou 

cat SPG.log | awk -F \; '{if(length($3)==0)print}'

input
IMS-CAMEL-Services;5511920003408;11:11
IMS-CAMEL-Services;5511920060469;11:11

output
IMS-CAMEL-Services;5521981130892;
IMS-CAMEL-Services;5581999237704;

! todos os HLRs primarios brasil !

scp HSNE0*.csv.gz bkphss@10.192.12.171:/dump/batimento/HLR
scp HSPO02*.csv.gz bkphss@10.192.12.171:/dump/batimento/HLR
scp HRJO02*.csv.gz bkphss@10.192.12.171:/dump/batimento/HLR
scp HRJO06*.csv.gz bkphss@10.192.12.171:/dump/batimento/HLR
scp HCTA*.csv.gz bkphss@10.192.12.171:/dump/batimento/HLR
scp HBSA01*.csv.gz bkphss@10.192.12.171:/dump/batimento/HLR
scp HRCE*.csv.gz bkphss@10.192.12.171:/dump/batimento/HLR
scp HBLM*.csv.gz bkphss@10.192.12.171:/dump/batimento/HLR
scp HSDR02*.csv.gz bkphss@10.192.12.171:/dump/batimento/HLR
scp HBHE02*.csv.gz bkphss@10.192.12.171:/dump/batimento/HLR
scp HBHE03*.csv.gz bkphss@10.192.12.171:/dump/batimento/HLR
scp HMNS01*.csv.gz bkphss@10.192.12.171:/dump/batimento/HLR

zcat HCTA01*.csv.gz   | awk 'BEGIN { FS = OFS = ";" } ; {print $3,$2,$93,$144,$124}' > /inputs/BATIMENTO/hlr.csv
zcat HCTA04*.csv.gz   | awk 'BEGIN { FS = OFS = ";" } ; {print $3,$2,$93,$144,$124}' >> /inputs/BATIMENTO/hlr.csv

zcat HBSA01*.csv.gz |   awk 'BEGIN { FS = OFS = ";" } ; {print $3,$2,$93,$144,$124}' >> /inputs/BATIMENTO/hlr.csv
zcat HRCE*.csv.gz   |   awk 'BEGIN { FS = OFS = ";" } ; {print $3,$2,$93,$144,$124}' >> /inputs/BATIMENTO/hlr.csv
zcat HBLM*.csv.gz   |   awk 'BEGIN { FS = OFS = ";" } ; {print $3,$2,$93,$144,$124}' >> /inputs/BATIMENTO/hlr.csv
zcat HSDR02*.csv.gz |   awk 'BEGIN { FS = OFS = ";" } ; {print $3,$2,$93,$144,$124}' >> /inputs/BATIMENTO/hlr.csv
zcat HBHE02*.csv.gz |   awk 'BEGIN { FS = OFS = ";" } ; {print $3,$2,$93,$144,$124}' >> /inputs/BATIMENTO/hlr.csv
zcat HBHE03*.csv.gz |   awk 'BEGIN { FS = OFS = ";" } ; {print $3,$2,$93,$144,$124}' >> /inputs/BATIMENTO/hlr.csv
zcat HMNS01*.csv.gz |   awk 'BEGIN { FS = OFS = ";" } ; {print $3,$2,$93,$144,$124}' >> /inputs/BATIMENTO/hlr.csv

zcat UDC*CSPS.csv.gz   | awk 'BEGIN { FS = OFS = ";" } ; {print $7,$5,$74,$33,$62}' > /inputs/BATIMENTO/hlrfe.csv


! batimento initial register !
! msisdn, ts11, cat, stype, csp, schar !   

MSISDN,IMSI,NAM,TS11,TS21,TS22,OBO,OBI,OBCC,SCHAR,CAT,CLIP,CSP

zcat HRCE*.csv.gz   |   awk 'BEGIN { FS = OFS = ";" } ; {print $3,$2,$108,$54,$57,$58,$26,$27,$154,$124,$24,$41,$144}' > /inputs/BATIMENTO/hlrgsim.csv
zcat HBLM*.csv.gz   |   awk 'BEGIN { FS = OFS = ";" } ; {print $3,$2,$108,$54,$57,$58,$26,$27,$154,$124,$24,$41,$144}' >> /inputs/BATIMENTO/hlrgsim.csv
zcat HSDR02*.csv.gz |   awk 'BEGIN { FS = OFS = ";" } ; {print $3,$2,$108,$54,$57,$58,$26,$27,$154,$124,$24,$41,$144}' >> /inputs/BATIMENTO/hlrgsim.csv
zcat HMNS01*.csv.gz |   awk 'BEGIN { FS = OFS = ";" } ; {print $3,$2,$108,$54,$57,$58,$26,$27,$154,$124,$24,$41,$144}' >> /inputs/BATIMENTO/hlrgsim.csv

zcat UDC*CSPS.csv.gz   | awk 'BEGIN { FS = OFS = ";" } ; {print $7,$5,$49,$79,$80,$81,$52,$51,$50,$65,$16,$34,$36}' > /inputs/BATIMENTO/hlrfegsim.csv


zcat UDC*EPS.csv.gz   | awk 'BEGIN { FS = OFS = ";" } ; {print $7,$27}' > /inputs/BATIMENTO/hssgsim.csv


zcat SPG_UDC*.csv.gz | awk 'BEGIN { FS = OFS = "|"} ; { print $1,$30,$15}' > /inputs/BATIMENTO/spg.csv

! somente msisdn, imsi, cat e csp filtrado por cn 552x !
zcat UDC*CSPS.csv.gz   | awk 'BEGIN { FS = OFS = ";" } ; {if(substr($7,1,3)== 552)print $7,$5,$13,$33}' > /inputs/BATIMENTO/hlrfe.csv

! msisdn, imsi, cat, osb1, osb2, osb3, osb4, obcc, csp, stype !
zcat H*.csv.gz | awk -F \; '{ print $3","$2","$24","$32","$33","$34","$35","$154","$144","$93}' > hlr_1202.log

! msisdn, imsi, cat, stype, csp, osb1, osb2, osb3, osb4, vlraddr !
zcat H*.csv.gz | awk -F \; '{ print $3";"$2";"$24";"$93";"$144";"$32";"$33";"$34";"$35";"$276}'

remane=sud_21=cat rename=sud_90=stype rename=sud_141=csp rename=sud_29=osb rename=sud_30=osb2 rename=sud_31=osb3 rename=sud_32=osb4 rename=ss_vlrAddress=vlr

! marcando um field separator para sort ( -t"," )

cat SPG_1202_ODB1.log | sort -k1 -t"," -T /dump > SPG_1202_ODB2.log


! printar arquivos por nome, por ordem reversa de tamanho !

ls |awk '{print length($0)"\t"$0}' |sort -r |cut --complement -f1

! awk com contem parte do pattern !
zcat CUDB_20200401_parser_19_EPS.csv.gz | awk -F \; '{if($14 ~ /411/) print $7";"$14}'

output
5512981685350;411,260,451,337,1
5512981749224;411,451,337,260,1
5512981941487;260,411,451,337,1
5512981746117;260,411,451,337,1
5512982725845;411,260,451,337,1
5512982503274;411,451,337,1,260
5512981748172;411,1,260,451,337

O $14 é uma variavel que contém vários numeros, porém a idéia era listar quem tinha o 411
como um dos possíveis valores


! coletar quem possui +550 nos CFs do SPG !
zcat SPG_20200526_parser_23.csv.gz | awk -F \| '{if($9 ~ /+/ || $10 ~ /+/|| $11 ~ /+/|| $12 ~ /+/|| $17 ~ /+/)print $1";"$2";"$7";"$15";"$30}'


! codigo para normalizar data campos $9, $10 e $12 do cbcf !
zcat CBCF_*.gz | awk 'BEGIN { FS = OFS = "|" } {split ($9, T, "-");split ($10, Y, "-");split ($12, Z, "-"); print $1,$2,$3,$4,$5,$6,$7,$8, substr(T[3],1,2) "/" T[2] "/" T[1],substr(Y[3],1,2) "/" Y[2] "/" Y[1],$11,substr(Z[3],1,2) "/" Z[2] "/" Z[1],$13,$14,$15}' > /inputs/BATIMENTO/CBCF.csv

! codigo para normalizar data campos $5 do siebel descontos !
zcat SIEBEL_POS_DESC*.gz | awk 'BEGIN { FS = OFS = "|" } {split ($5, T, " "); print $1,$2,$3,$4,T[1],$6,$7,$8}' > /inputs/BATIMENTO/SIEBEL.csv

Estudo anatel turbina

cd 20200901
zcat * |  awk 'BEGIN { FS = OFS = "," } ; {print $8,$11,$13,$15,$20,$25}' > /inputs/BATIMENTO/Anatel.csv
cd ..
cd 20200902
zcat * |  awk 'BEGIN { FS = OFS = "," } ; {print $8,$11,$13,$15,$20,$25}' >> /inputs/BATIMENTO/Anatel.csv
cd ..
cd 20200903
zcat * |  awk 'BEGIN { FS = OFS = "," } ; {print $8,$11,$13,$15,$20,$25}' >> /inputs/BATIMENTO/Anatel.csv
cd ..
cd 20200904
zcat * |  awk 'BEGIN { FS = OFS = "," } ; {print $8,$11,$13,$15,$20,$25}' >> /inputs/BATIMENTO/Anatel.csv
cd ..
cd 20200905
zcat * |  awk 'BEGIN { FS = OFS = "," } ; {print $8,$11,$13,$15,$20,$25}' >> /inputs/BATIMENTO/Anatel.csv
cd ..
cd 20200906
zcat * |  awk 'BEGIN { FS = OFS = "," } ; {print $8,$11,$13,$15,$20,$25}' >> /inputs/BATIMENTO/Anatel.csv
cd ..
cd 20200907
zcat * |  awk 'BEGIN { FS = OFS = "," } ; {print $8,$11,$13,$15,$20,$25}' >> /inputs/BATIMENTO/Anatel.csv
cd ..
cd 20200908
zcat * |  awk 'BEGIN { FS = OFS = "," } ; {print $8,$11,$13,$15,$20,$25}' >> /inputs/BATIMENTO/Anatel.csv
cd ..
cd 20200909
zcat * |  awk 'BEGIN { FS = OFS = "," } ; {print $8,$11,$13,$15,$20,$25}' >> /inputs/BATIMENTO/Anatel.csv
cd ..
cd 20200910
zcat * |  awk 'BEGIN { FS = OFS = "," } ; {print $8,$11,$13,$15,$20,$25}' >> /inputs/BATIMENTO/Anatel.csv
cd ..
cd 20200911
zcat * |  awk 'BEGIN { FS = OFS = "," } ; {print $8,$11,$13,$15,$20,$25}' >> /inputs/BATIMENTO/Anatel.csv
cd ..
cd 20200912
zcat * |  awk 'BEGIN { FS = OFS = "," } ; {print $8,$11,$13,$15,$20,$25}' >> /inputs/BATIMENTO/Anatel.csv
cd ..
cd 20200913
zcat * |  awk 'BEGIN { FS = OFS = "," } ; {print $8,$11,$13,$15,$20,$25}' >> /inputs/BATIMENTO/Anatel.csv
cd ..
cd 20200914
zcat * |  awk 'BEGIN { FS = OFS = "," } ; {print $8,$11,$13,$15,$20,$25}' >> /inputs/BATIMENTO/Anatel.csv
cd ..

! replacing acentos !
cat Anatel.csv | sed -r 's/ô/o/g' | sed -r 's/à/a/g' | sed -r 's/é/e/g' | sed -r 's/í/i/g' | sed -r 's/ó/o/g' | sed -r 's/ô/o/g' | sed -r 's/ú/u/g' | sed -r 's/ã/a/g'  > Anatel1.csv

CRC

cd 20200901
zcat SIEBEL_POS* |  awk 'BEGIN { FS = OFS = "|" } ; {print $1,$2,$3,$5,$6,$8,$9,$10}' > /inputs/BATIMENTO/crc.csv
cd ..
cd 20200902
zcat SIEBEL_POS* |  awk 'BEGIN { FS = OFS = "|" } ; {print $1,$2,$3,$5,$6,$8,$9,$10}' >> /inputs/BATIMENTO/crc.csv
cd ..
cd 20200903
zcat SIEBEL_POS* |  awk 'BEGIN { FS = OFS = "|" } ; {print $1,$2,$3,$5,$6,$8,$9,$10}' >> /inputs/BATIMENTO/crc.csv
cd ..
cd 20200904
zcat SIEBEL_POS* |  awk 'BEGIN { FS = OFS = "|" } ; {print $1,$2,$3,$5,$6,$8,$9,$10}' >> /inputs/BATIMENTO/crc.csv
cd ..
cd 20200905
zcat SIEBEL_POS* |  awk 'BEGIN { FS = OFS = "|" } ; {print $1,$2,$3,$5,$6,$8,$9,$10}' >> /inputs/BATIMENTO/crc.csv
cd ..
cd 20200906
zcat SIEBEL_POS* |  awk 'BEGIN { FS = OFS = "|" } ; {print $1,$2,$3,$5,$6,$8,$9,$10}' >> /inputs/BATIMENTO/crc.csv
cd ..
cd 20200907
zcat SIEBEL_POS* |  awk 'BEGIN { FS = OFS = "|" } ; {print $1,$2,$3,$5,$6,$8,$9,$10}' >> /inputs/BATIMENTO/crc.csv
cd ..
cd 20200908
zcat SIEBEL_POS* |  awk 'BEGIN { FS = OFS = "|" } ; {print $1,$2,$3,$5,$6,$8,$9,$10}' >> /inputs/BATIMENTO/crc.csv
cd ..
cd 20200909
zcat SIEBEL_POS* |  awk 'BEGIN { FS = OFS = "|" } ; {print $1,$2,$3,$5,$6,$8,$9,$10}' >> /inputs/BATIMENTO/crc.csv
cd ..
cd 20200910
zcat SIEBEL_POS* |  awk 'BEGIN { FS = OFS = "|" } ; {print $1,$2,$3,$5,$6,$8,$9,$10}' >> /inputs/BATIMENTO/crc.csv
cd ..
cd 20200911
zcat SIEBEL_POS* |  awk 'BEGIN { FS = OFS = "|" } ; {print $1,$2,$3,$5,$6,$8,$9,$10}' >> /inputs/BATIMENTO/crc.csv
cd ..
cd 20200912
zcat SIEBEL_POS* |  awk 'BEGIN { FS = OFS = "|" } ; {print $1,$2,$3,$5,$6,$8,$9,$10}' >> /inputs/BATIMENTO/crc.csv
cd ..
cd 20200913
zcat SIEBEL_POS* |  awk 'BEGIN { FS = OFS = "|" } ; {print $1,$2,$3,$5,$6,$8,$9,$10}' >> /inputs/BATIMENTO/crc.csv
cd ..
cd 20200914
zcat SIEBEL_POS* |  awk 'BEGIN { FS = OFS = "|" } ; {print $1,$2,$3,$5,$6,$8,$9,$10}' >> /inputs/BATIMENTO/crc.csv
cd ..
 
 

zcat SIEBEL_POS_2020*.txt.gz | awk 'BEGIN { FS = OFS = "|"} ; {if(substr($2,1,2)==68)print}' > /inputs/BATIMENTO/siebelmig.csv
zcat SIEBEL_POS_2020*.txt.gz | awk 'BEGIN { FS = OFS = "|"} ; {if(substr($2,1,2)==92)print}' >> /inputs/BATIMENTO/siebelmig.csv
zcat SIEBEL_POS_2020*.txt.gz | awk 'BEGIN { FS = OFS = "|"} ; {if(substr($2,1,2)==97)print}' >> /inputs/BATIMENTO/siebelmig.csv

zcat SIEBEL_POS_LIVE_2020*.txt.gz | grep oIP | awk 'BEGIN { FS = OFS = "|"} ; {if(substr($4,1,2)==68)print}' > /inputs/BATIMENTO/siebelive.csv
zcat SIEBEL_POS_LIVE_2020*.txt.gz | grep oIP | awk 'BEGIN { FS = OFS = "|"} ; {if(substr($4,1,2)==92)print}' >> /inputs/BATIMENTO/siebelive.csv
zcat SIEBEL_POS_LIVE_2020*.txt.gz | grep oIP | awk 'BEGIN { FS = OFS = "|"} ; {if(substr($4,1,2)==97)print}' >> /inputs/BATIMENTO/siebelive.csv

fact.vw_rede_ocs_cdr_rec_charging

A385_OFFERNAME
ROUND(A041_DEBIT_AMOUNT::numeric/100,2) as A041_DEBIT_AMOUNT


zmore multiSCsUDC1_01_20201029.ldif.gz | grep -A 10 -B 15 APNID | egrep '(MSISDN|APNID)' |  

output
MSISDN: 5515976034465
APNID1: 447
MSISDN: 5512976067188
APNID1: 447
MSISDN: 5517982291418
APNID1: 337
APNID2: 302
MSISDN: 5512981613543
APNID1: 337
APNID2: 451
            
            


! utilizando variavel bash no awk !
! awk -v variavel !
for n in $(cat lista); do cd /works/dumps_bkp/FRONT_END/SIEBEL_POS/$n ; zmore SIEBEL_POS_LIVE_202*_parsed.txt.gz | awk -v a="$n" 'BEGIN { FS = OFS = "|" } ;{if($1=="Banda Larga") print a";"$2";"$6}' | grep -v Ativo >> /inputs/BATIMENTO/suspensos.csv; echo "realizado coleta dos dados de $n" ; done;

! apagando primeira linha !

sed -i '1d' /inputs/BATIMENTO/ESTUDO/saitro.csv

! inserindo na primeira linha !

sed -i '1s/^/DESC_CATEGORIA|MSISDN\n/' /inputs/BATIMENTO/ESTUDO/saitro.csv


zcat saitro_gsim_20210430.csv.gz | awk -F \; '{print "GSIM|"$7}' | sed -r 's/"//g' > /inputs/BATIMENTO/ESTUDO/saitro.csv
sed -i '1d' /inputs/BATIMENTO/ESTUDO/saitro.csv
sed -i '1s/^/DESC_CATEGORIA|MSISDN\n/' /inputs/BATIMENTO/ESTUDO/saitro.csv

! extrator com nome do arquivo junto da evidencia no mesmo arquivo !

for n in ls KPI_[1-9][1-9]_* ; do zcat $n | awk -v a="$n" -F \; '{print a";"$1}' ; done | sed -e 's/\.csv\.gz//g' > /inputs/BATIMENTO/ESTUDO/bat_ofensores_0607.csv



! bloco de consulta padrão LDAP !
! PLDB - MSISDN, IMSI, IMPI e IMPU !
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "msisdn=5562981130160,dc=msisdn,ou=identities,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "serv=identities,msisdn=5562981130160,dc=msisdn,ou=identities,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "serv=identities,imsi=724029202930957,dc=imsi,ou=identities,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "serv=identities,impi=724046201948529@ims.mnc004.mcc724.3gppnetwork.org,dc=impi,ou=identities,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "IMPU=sip:724046201948529@ims.mnc004.mcc724.3gppnetwork.org,dc=impu,ou=identities,dc=tim" -o ldif-wrap=no -a always -s sub
! DSG's - mscId!
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "msisdn=5551983141296,dc=msisdn,ou=identities,dc=tim" -o ldif-wrap=no -a always -s one | grep dn:
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "serv=identities,mscid=aaaaaa006aaaaaaaa724029202930957,ou=multiSCs,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "serv=AAA,mscid=aaaaaa006aaaaaaaa724029202930957,ou=multiSCs,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "serv=auth,mscid=aaaaaa006aaaaaaaa724029202930957,ou=multiSCs,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "serv=csps,mscid=aaaaaa006aaaaaaaa724029202930957,ou=multiSCs,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "serv=eps,mscid=aaaaaa006aaaaaaaa724029202930957,ou=multiSCs,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "serv=ims,mscid=c0ac2611e6db458f9d56b8aa8b6bd065,ou=multiSCs,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "mscid=aaaaaa006aaaaaaaa724029202930957,ou=multiSCs,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "mscid=aaaaaa006aaaaaaaa724029202930957,ou=multiSCs,dc=tim" -o ldif-wrap=no -a always -s sub | egrep -i 'serv:|state|date|msi|imp|dsu'
! VoLTE DSG's - MSISDN !
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "associd=5551983141296,ou=Associations,dc=tim" -o ldif-wrap=no -a always -s sub


724029202930957

mysql -h pl0 -proot -P 15000 -e "select * from cudb_user_data.IDEN_MSISDN where MSISDN like '5591985497642%';"


mysql -h pl0 -proot -P 15000 -e "select * from cudb_user_data.IDEN_IMSI where IMSI like '724029410964828%';"
mysql -h pl0 -proot -P 15000 -e "select * from cudb_user_data.IDEN_MSISDN where MSISDN like '%5592981557601%';"
mysql -h pl0 -proot -P 15000 -e "select * from cudb_user_data.IDEN_IMPI where IMPI like '724029410964828%';"
mysql -h pl0 -proot -P 15000 -e "select * from cudb_user_data.IDEN_IMPU where IMPU like 'sip:724029410964828%';"
mysql -h pl0 -proot -P 15000 -e "select * from cudb_user_data.IDEN_IMPU where IMPU like '%5551983141296%';"

mysql -h PL0 -proot -P 15000 -e "delete from cudb_user_data.IDEN_IMSI where IMSI like '724029202930957';" 
mysql -h pl0 -proot -P 15000 -e "delete from cudb_user_data.IDEN_MSISDN where MSISDN like '%5591985497642%';"
mysql -h PL0 -proot -P 15000 -e "delete from cudb_user_data.IDEN_IMPI where IMPI like '724029202930957%';" 
mysql -h PL0 -proot -P 15000 -e "delete from cudb_user_data.IDEN_IMPU where IMPU like 'sip:724029202930957%';" 
mysql -h PL0 -proot -P 15000 -e "delete from cudb_user_data.IDEN_IMPU where IMPU like '%5591985497642%';" 


! Acesso MYSQL !
mysql -h pl0 -proot -P 15000
show databases;
use cudb_user_data
select database();
status;
show tables;

#EPS/CSPS/AUTH			
mysql -h pl0 -proot -P 15000 -e "select * FROM cudb_user_data.IDEN_MSISDN WHERE aliasedObjectName LIKE'%f78a7d5f654941c39c3627ee70aa14f9%';"
mysql -h pl0 -proot -P 15000 -e "select * FROM cudb_user_data.IDEN_IMSI WHERE aliasedObjectName LIKE'%f78a7d5f654941c39c3627ee70aa14f9%';"
mysql -h pl0 -proot -P 15000 -e "select * FROM cudb_user_data.IDEN_MSISDN WHERE MSISDN LIKE'%5573991448921%';"
mysql -h pl0 -proot -P 15000 -e "select * FROM cudb_user_data.IDEN_IMSI WHERE IMSI LIKE '%724027405730134%';"
mysql -h pl0 -proot -P 15000 -e "select * FROM cudb_user_data.CUDBMultiServiceConsumer WHERE mscId LIKE'%f78a7d5f654941c39c3627ee70aa14f9%';"
mysql -h pl0 -proot -P 15000 -e "select * FROM cudb_user_data.CUDB_DE WHERE RDN LIKE'%f78a7d5f654941c39c3627ee70aa14f9%';"
#IMS			
mysql -h pl0 -proot -P 15000 -e "select * FROM cudb_user_data.IDEN_IMPI WHERE aliasedObjectName LIKE'%ab1bfbe2a8714203b8b911e5cb3caebc%';"
mysql -h pl0 -proot -P 15000 -e "select * FROM cudb_user_data.IDEN_IMPI WHERE IMPI LIKE '%724045410615539%';"
mysql -h pl0 -proot -P 15000 -e "select * FROM cudb_user_data.IDEN_IMPU WHERE IMPU LIKE '%724045410615539%';"
mysql -h pl0 -proot -P 15000 -e "select * FROM cudb_user_data.IDEN_IMPU WHERE IMPU LIKE'%5551983141296%';"
mysql -h pl0 -proot -P 15000 -e "select * FROM cudb_user_data.IDEN_IMPU WHERE aliasedObjectName LIKE'%5551983141296%';"
mysql -h pl0 -proot -P 15000 -e "select * FROM cudb_user_data.CUDBAssociation WHERE assocId LIKE'%5551983141296%';"
mysql -h pl0 -proot -P 15000 -e "select * FROM cudb_user_data.CUDB_DE WHERE RDN LIKE'%5551983141296%';"
mysql -h pl0 -proot -P 15000 -e "select * from cudb_user_data.CUDBAssociation where assocId like '%5551983141296%';"




mysql -h pl0 -proot -P 15000 -e "delete FROM cudb_user_data.IDEN_IMPI WHERE aliasedObjectName LIKE'aaaaaa005aaaaaaaa724029410964828';"
mysql -h pl0 -proot -P 15000 -e "delete FROM cudb_user_data.IDEN_IMPI WHERE IMPI LIKE '724029410964828';"
mysql -h pl0 -proot -P 15000 -e "delete FROM cudb_user_data.IDEN_IMPU WHERE IMPU LIKE '724029410964828';"
mysql -h pl0 -proot -P 15000 -e "delete FROM cudb_user_data.IDEN_IMPU WHERE IMPU LIKE'5592981557601';"
mysql -h pl0 -proot -P 15000 -e "delete FROM cudb_user_data.IDEN_IMPU WHERE aliasedObjectName LIKE'5592981557601';"
mysql -h pl0 -proot -P 15000 -e "delete FROM cudb_user_data.CUDBAssociation WHERE assocId LIKE'5592981557601';"
mysql -h pl0 -proot -P 15000 -e "delete FROM cudb_user_data.CUDB_DE WHERE RDN LIKE'5592981557601';"
mysql -h pl0 -proot -P 15000 -e "delete from cudb_user_data.CUDB_DE where rdn like 'assocId=5592981557601';"



! bloco de consulta padrão LDAP !
! PLDB - MSISDN, IMSI, IMPI e IMPU !
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "msisdn=5562981130160,dc=msisdn,ou=identities,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "serv=identities,msisdn=5562981130160,dc=msisdn,ou=identities,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "serv=identities,imsi=724046201948529,dc=imsi,ou=identities,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "serv=identities,impi=724046201948529@ims.mnc004.mcc724.3gppnetwork.org,dc=impi,ou=identities,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "IMPU=sip:724046201948529@ims.mnc004.mcc724.3gppnetwork.org,dc=impu,ou=identities,dc=tim" -o ldif-wrap=no -a always -s sub
! DSG's - mscId!
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "msisdn=5592981557601,dc=msisdn,ou=identities,dc=tim" -o ldif-wrap=no -a always -s one | grep dn:
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "serv=identities,mscid=fe9f3c98f3a2438fa232e6f0bd135549,ou=multiSCs,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "serv=AAA,mscid=fe9f3c98f3a2438fa232e6f0bd135549,ou=multiSCs,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "serv=auth,mscid=fe9f3c98f3a2438fa232e6f0bd135549,ou=multiSCs,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "serv=csps,mscid=fe9f3c98f3a2438fa232e6f0bd135549,ou=multiSCs,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "serv=eps,mscid=fe9f3c98f3a2438fa232e6f0bd135549,ou=multiSCs,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "serv=ims,mscid=fe9f3c98f3a2438fa232e6f0bd135549,ou=multiSCs,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "mscid=fe9f3c98f3a2438fa232e6f0bd135549,ou=multiSCs,dc=tim" -o ldif-wrap=no -a always -s sub
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "mscid=aaaaaa005aaaaaaaa724029410964828,ou=multiSCs,dc=tim" -o ldif-wrap=no -a always -s sub | egrep -i 'serv:|state|date|msi|imp|dsu'
! VoLTE DSG's - MSISDN !
ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "associd=5562981130160,ou=Associations,dc=tim" -o ldif-wrap=no -a always -s sub


ldapsearch -H ldap://PL0:389 -x -D "cn=manager,dc=tim" -w "normal" -b "serv=ims,assocId=5592981557601,ou=Associations,dc=tim" -o ldif-wrap=no -a always -s sub

! coletando spg dados de time de aprovisionamento !

/dump/IMS/SPG/
zmore ServiceLog_20211019*.tar.gz | grep ADD_MSR | awk 'BEGIN {FS = OFS= "\","} ; {print $56}' | grep -i resultcode=0 | awk -F \,0,\" '{print $1}'

zmore ServiceLog_20211019*.tar.gz |  grep ',bssuser,LST_MSR' | awk 'BEGIN {FS = OFS= ","} ; {print $6","$7}' | sed 's/2021-10-1[8-9] //g' > /dump/IMS/SPG/hgsdr3_lst.csv

zmore ServiceLog_20211019*.tar.gz |  grep ',bssuser,MOD_MSR' | awk -F \,2021-10-1[8-9] '{print $2","$3}' | grep -i result | sed 's/,0,"Result\/ResultCode=0;//g' > /dump/IMS/SPG/hgsdr3_mod_msr.csv

5511986486080 - churn - nao existe no fnr - lixo no cudb
5551983141296 - assinante ativo, sem volte e com lixo no cudb association ( faltando dados ). Limpeza 
5555981535073 - assinante ativo, com volte e com lixo no cudb association ( faltando dados ). Necessário reaprovisionar. Assinante impactado
5577991976618 - nao vi falha nesse assinante


ldapsearch -x -H ldap://10.46.75.226:389 -D ""cudbUser=hssuser,ou=admin,dc=tim"" -w ""hssuser123"" -b ""associd=5555981535073,ou=Associations,dc=tim"" -s sub -a always | grep dn


HUBSA1 SC_2_2# cudbSystemStatus -R

Execution date: Thu Jul  7 20:35:18 -03 2022

Checking Replication Channels in the System:
        Node    | 16  | 17  | 31  | 32  | 61  | 62
        ============================================
[-E-]   PLDB ___|_[S]_|_[S]_|_[S]_|_[S]_|__M__|__S1_
        DSG 1 __|__M__|_____|__S1_|_____|__S1_|_____
        DSG 2 __|__M__|_____|__S2_|_____|__S2_|_____
        DSG 3 __|__M__|_____|__S2_|_____|__S2_|_____
        DSG 4 __|__M__|_____|__S1_|_____|__S2_|_____
        DSG 5 __|__S1_|_____|__M__|_____|__S2_|_____
        DSG 6 __|__S1_|_____|__M__|_____|__S2_|_____
        DSG 7 __|__S1_|_____|__M__|_____|__S2_|_____
        DSG 8 __|__S1_|_____|__S1_|_____|__M__|_____
        DSG 9 __|__S1_|_____|__S2_|_____|__M__|_____
        DSG 10 _|__S2_|_____|__S1_|_____|__M__|_____
        DSG 11 _|_____|__M__|_____|__S2_|_____|__S1_
        DSG 12 _|_____|__M__|_____|__S2_|_____|__S2_
        DSG 13 _|_____|__M__|_____|__S2_|_____|__S1_
        DSG 14 _|_____|__M__|_____|__S2_|_____|__S1_
        DSG 15 _|_____|__S2_|_____|__M__|_____|__S1_
        DSG 16 _|_____|__S1_|_____|__M__|_____|__S1_
        DSG 17 _|_____|__S1_|_____|__M__|_____|__S1_
        DSG 18 _|_____|__S1_|_____|__S2_|_____|__M__
        DSG 19 _|_____|__S2_|_____|__S1_|_____|__M__
        DSG 20 _|_____|__S2_|_____|__S1_|_____|__M__

                 [-E-] [-E-] [-E-] [-E-]

Printing Detailed Replication Status for the Slave Replicas:
Node 16:
        Replication in DSG0           .... Stopped - From Thu Jul  7 09:40:13 -03 2022
        Replication in DSG5(Chan=1)   .... Up -- Delay = 0.4 seconds,   no. of pending changes = 509
        Replication in DSG6(Chan=1)   .... Up -- Delay = 0.3 seconds,   no. of pending changes = 348
        Replication in DSG7(Chan=1)   .... Up -- Delay = 0.3 seconds,   no. of pending changes = 340
        Replication in DSG8(Chan=1)   .... Up -- Delay = 0.3 seconds,   no. of pending changes = 375
        Replication in DSG9(Chan=1)   .... Up -- Delay = 0.3 seconds,   no. of pending changes = 348
        Replication in DSG10(Chan=2)  .... Up -- Delay = 0.3 seconds,   no. of pending changes = 365
Node 17:
        Replication in DSG0           .... Stopped - From Thu Jul  7 09:40:13 -03 2022
        Replication in DSG15(Chan=2)  .... Up -- Delay = 0.3 seconds,   no. of pending changes = 414
        Replication in DSG16(Chan=1)  .... Up -- Delay = 0.4 seconds,   no. of pending changes = 557
        Replication in DSG17(Chan=1)  .... Up -- Delay = 0.3 seconds,   no. of pending changes = 421
        Replication in DSG18(Chan=1)  .... Up -- Delay = 0.3 seconds,   no. of pending changes = 302
        Replication in DSG19(Chan=2)  .... Up -- Delay = 0.3 seconds,   no. of pending changes = 359
        Replication in DSG20(Chan=2)  .... Up -- Delay = 0.2 seconds,   no. of pending changes = 247
Node 31:
        Replication in DSG0           .... Stopped - From Thu Jul  7 09:40:13 -03 2022
        Replication in DSG1(Chan=1)   .... Up -- Delay = 0.4 seconds,   no. of pending changes = 498
        Replication in DSG2(Chan=2)   .... Up -- Delay = 0.3 seconds,   no. of pending changes = 373
        Replication in DSG3(Chan=2)   .... Up -- Delay = 0.3 seconds,   no. of pending changes = 337
        Replication in DSG4(Chan=1)   .... Up -- Delay = 0.4 seconds,   no. of pending changes = 481
        Replication in DSG8(Chan=1)   .... Up -- Delay = 0.2 seconds,   no. of pending changes = 262
        Replication in DSG9(Chan=2)   .... Up -- Delay = 0.2 seconds,   no. of pending changes = 316
        Replication in DSG10(Chan=1)  .... Up -- Delay = 0.3 seconds,   no. of pending changes = 366
Node 32:
        Replication in DSG0           .... Stopped - From Thu Jul  7 09:40:13 -03 2022
        Replication in DSG11(Chan=2)  .... Up -- Delay = 0.3 seconds,   no. of pending changes = 406
        Replication in DSG12(Chan=2)  .... Up -- Delay = 0.3 seconds,   no. of pending changes = 377
        Replication in DSG13(Chan=2)  .... Up -- Delay = 0.4 seconds,   no. of pending changes = 626
        Replication in DSG14(Chan=2)  .... Up -- Delay = 0.3 seconds,   no. of pending changes = 401
        Replication in DSG18(Chan=2)  .... Up -- Delay = 0.3 seconds,   no. of pending changes = 322
        Replication in DSG19(Chan=1)  .... Up -- Delay = 0.3 seconds,   no. of pending changes = 480
        Replication in DSG20(Chan=1)  .... Up -- Delay = 0.3 seconds,   no. of pending changes = 360
Node 61:
        Replication in DSG1(Chan=1)   .... Up -- Delay = 0.2 seconds,   no. of pending changes = 272
        Replication in DSG2(Chan=2)   .... Up -- Delay = 0.3 seconds,   no. of pending changes = 303
        Replication in DSG3(Chan=2)   .... Up -- Delay = 0.3 seconds,   no. of pending changes = 344
        Replication in DSG4(Chan=2)   .... Up -- Delay = 0.3 seconds,   no. of pending changes = 386
        Replication in DSG5(Chan=2)   .... Up -- Delay = 0.2 seconds,   no. of pending changes = 273
        Replication in DSG6(Chan=2)   .... Up -- Delay = 0.3 seconds,   no. of pending changes = 366
        Replication in DSG7(Chan=2)   .... Up -- Delay = 0.3 seconds,   no. of pending changes = 413
Node 62:
        Replication in DSG0(Chan=1)   .... Up -- Delay = 0.0 seconds,   no. of pending changes = 0
        Replication in DSG11(Chan=1)  .... Up -- Delay = 0.2 seconds,   no. of pending changes = 229
        Replication in DSG12(Chan=2)  .... Up -- Delay = 0.3 seconds,   no. of pending changes = 503
        Replication in DSG13(Chan=1)  .... Up -- Delay = 0.3 seconds,   no. of pending changes = 363
        Replication in DSG14(Chan=1)  .... Up -- Delay = 0.2 seconds,   no. of pending changes = 234
        Replication in DSG15(Chan=1)  .... Up -- Delay = 0.3 seconds,   no. of pending changes = 378
        Replication in DSG16(Chan=1)  .... Up -- Delay = 0.3 seconds,   no. of pending changes = 379
        Replication in DSG17(Chan=1)  .... Up -- Delay = 0.4 seconds,   no. of pending changes = 529

10.46.35.80

ldapsearch -x -P 3 -h PL0 -p 389 -D "cn=manager,dc=tim" -w "normal" -a always -b "IMSI=724046600510645,dc=imsi,ou=Identities,dc=tim" | grep -i DSU
 
ldapsearch -x -H ldap://10.46.35.80:389 -D ""cudbUser=hssuser,ou=admin,dc=tim"" -w ""hssuser123"" -a always -b "IMSI=724046600510645,dc=imsi,ou=Identities,dc=tim" | grep -i DSU

ldapsearch -x -H ldap://10.46.75.226:389 -D ""cudbUser=hssuser,ou=admin,dc=tim"" -w ""hssuser123"" -b "IMSI=724046600510645,dc=imsi,ou=Identities,dc=tim" -o ldif-wrap=no -a always -s sub

ldapsearch -x -H ldap://10.46.35.80:389 -D ""cudbUser=hssuser,ou=admin,dc=tim"" -w ""hssuser123"" -b "serv=identities,msisdn=5564981160911,dc=msisdn,ou=identities,dc=tim" -o ldif-wrap=no -a always -s sub

